#ifndef TRIANGLEQUADRATURE_H
#define TRIANGLEQUADRATURE_H

#include "Vector3.h"
#include "FunctionArgs.h"
#include "MathUtils.h"
      
#define QUADMAXDEPTH 16
#define QUADLOGMAXDEPTH 16

template<class T, class F>
T quadgauss1(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v(0.0,0.0,0.0);
  Vector3 v0;
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	v.x = v0.x + 0.333333333333333 * v1.x + 0.333333333333333 * v2.x;
	v.y = v0.y + 0.333333333333333 * v1.y + 0.333333333333333 * v2.y;
	v.z = v0.z + 0.333333333333333 * v1.z + 0.333333333333333 * v2.z;
  T q;
	f(&v,&q,args);
  q *= 0.5;
  return q;
}

template<class T, class F>
T quadgauss3(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	T q;
	T r;
	v.x = v0x + 0.166666666666666 * v1x + 0.166666666666667 * v2x;
	v.y = v0y + 0.166666666666666 * v1y + 0.166666666666667 * v2y;
	v.z = v0z + 0.166666666666666 * v1z + 0.166666666666667 * v2z;
	f(&v,&q,args);
	q *= 0.166666666666667;
	v.x = v0x + 0.166666666666666 * v1x + 0.666666666666667 * v2x;
	v.y = v0y + 0.166666666666666 * v1y + 0.666666666666667 * v2y;
	v.z = v0z + 0.166666666666666 * v1z + 0.666666666666667 * v2z;
	f(&v,&r,args);
	r *= 0.166666666666667;
	q += r;
	v.x = v0x + 0.666666666666666 * v1x + 0.166666666666667 * v2x;
	v.y = v0y + 0.666666666666666 * v1y + 0.166666666666667 * v2y;
	v.z = v0z + 0.666666666666666 * v1z + 0.166666666666667 * v2z;
	f(&v,&r,args);
	r *= 0.166666666666667;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss6(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	T q;
	T r;
	v.x = v0x + 0.8168475729804 * v1x + 0.0915762135097999 * v2x;
	v.y = v0y + 0.8168475729804 * v1y + 0.0915762135097999 * v2y;
	v.z = v0z + 0.8168475729804 * v1z + 0.0915762135097999 * v2z;
	f(&v,&q,args);
	q *= 0.05497587182765;
	v.x = v0x + 0.0915762135097 * v1x + 0.0915762135098 * v2x;
	v.y = v0y + 0.0915762135097 * v1y + 0.0915762135098 * v2y;
	v.z = v0z + 0.0915762135097 * v1z + 0.0915762135098 * v2z;
	f(&v,&r,args);
	r *= 0.05497587182765;
	q += r;
	v.x = v0x + 0.0915762135097 * v1x + 0.8168475729805 * v2x;
	v.y = v0y + 0.0915762135097 * v1y + 0.8168475729805 * v2y;
	v.z = v0z + 0.0915762135097 * v1z + 0.8168475729805 * v2z;
	f(&v,&r,args);
	r *= 0.05497587182765;
	q += r;
	v.x = v0x + 0.4459484909159 * v1x + 0.445948490916 * v2x;
	v.y = v0y + 0.4459484909159 * v1y + 0.445948490916 * v2y;
	v.z = v0z + 0.4459484909159 * v1z + 0.445948490916 * v2z;
	f(&v,&r,args);
	r *= 0.111690794839;
	q += r;
	v.x = v0x + 0.4459484909159 * v1x + 0.1081030181681 * v2x;
	v.y = v0y + 0.4459484909159 * v1y + 0.1081030181681 * v2y;
	v.z = v0z + 0.4459484909159 * v1z + 0.1081030181681 * v2z;
	f(&v,&r,args);
	r *= 0.111690794839;
	q += r;
	v.x = v0x + 0.108103018168 * v1x + 0.445948490916 * v2x;
	v.y = v0y + 0.108103018168 * v1y + 0.445948490916 * v2y;
	v.z = v0z + 0.108103018168 * v1z + 0.445948490916 * v2z;
	f(&v,&r,args);
	r *= 0.111690794839;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss10(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	//WARNING: Evaluating on boundary
	T q;
	T r;
	v.x = v0x + v2x;
	v.y = v0y + v2y;
	v.z = v0z + v2z;
	f(&v,&q,args);
	q *= 0.0065678024876;
	//WARNING: Evaluating on boundary
	v.x = v0x;
	v.y = v0y;
	v.z = v0z;
	f(&v,&r,args);
	r *= 0.0065679153017;
	q += r;
	//WARNING: Evaluating on boundary
	v.x = v0x + v1x;
	v.y = v0y + v1y;
	v.z = v0z + v1z;
	f(&v,&r,args);
	r *= 0.00685409869;
	q += r;
	v.x = v0x + 0.0598527250105 * v1x + 0.672819921871 * v2x;
	v.y = v0y + 0.0598527250105 * v1y + 0.672819921871 * v2y;
	v.z = v0z + 0.0598527250105 * v1z + 0.672819921871 * v2z;
	f(&v,&r,args);
	r *= 0.058709596645575;
	q += r;
	v.x = v0x + 0.0598535871057 * v1x + 0.2673288599482 * v2x;
	v.y = v0y + 0.0598535871057 * v1y + 0.2673288599482 * v2y;
	v.z = v0z + 0.0598535871057 * v1z + 0.2673288599482 * v2z;
	f(&v,&r,args);
	r *= 0.0587103059567;
	q += r;
	v.x = v0x + 0.2634233538452 * v1x + 0.6716530111494 * v2x;
	v.y = v0y + 0.2634233538452 * v1y + 0.6716530111494 * v2y;
	v.z = v0z + 0.2634233538452 * v1z + 0.6716530111494 * v2z;
	f(&v,&r,args);
	r *= 0.06200629482785;
	q += r;
	v.x = v0x + 0.2634249770929 * v1x + 0.0649251690029 * v2x;
	v.y = v0y + 0.2634249770929 * v1y + 0.0649251690029 * v2y;
	v.z = v0z + 0.2634249770929 * v1z + 0.0649251690029 * v2z;
	f(&v,&r,args);
	r *= 0.062007623063025;
	q += r;
	v.x = v0x + 0.6652178176747 * v1x + 0.2693789366453 * v2x;
	v.y = v0y + 0.6652178176747 * v1y + 0.2693789366453 * v2y;
	v.z = v0z + 0.6652178176747 * v1z + 0.2693789366453 * v2z;
	f(&v,&r,args);
	r *= 0.062965115138225;
	q += r;
	v.x = v0x + 0.6652178055941 * v1x + 0.0654054874919 * v2x;
	v.y = v0y + 0.6652178055941 * v1y + 0.0654054874919 * v2y;
	v.z = v0z + 0.6652178055941 * v1z + 0.0654054874919 * v2z;
	f(&v,&r,args);
	r *= 0.06296651334145;
	q += r;
	v.x = v0x + 0.3226461603077 * v1x + 0.3386799893027 * v2x;
	v.y = v0y + 0.3226461603077 * v1y + 0.3386799893027 * v2y;
	v.z = v0z + 0.3226461603077 * v1z + 0.3386799893027 * v2z;
	f(&v,&r,args);
	r *= 0.11264473454785;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss15(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	//WARNING: Evaluating on boundary
	T q;
	T r;
	v.x = v0x;
	v.y = v0y;
	v.z = v0z;
	f(&v,&q,args);
	q *= 0.0025639543523;
	//WARNING: Evaluating on boundary
	v.x = v0x + v1x;
	v.y = v0y + v1y;
	v.z = v0z + v1z;
	f(&v,&r,args);
	r *= 0.0025639543523;
	q += r;
	//WARNING: Evaluating on boundary
	v.x = v0x + v2x;
	v.y = v0y + v2y;
	v.z = v0z + v2z;
	f(&v,&r,args);
	r *= 0.0025639543523;
	q += r;
	v.x = v0x + 0.1738960507346 * v1x + 0.0421382841642 * v2x;
	v.y = v0y + 0.1738960507346 * v1y + 0.0421382841642 * v2y;
	v.z = v0z + 0.1738960507346 * v1z + 0.0421382841642 * v2z;
	f(&v,&r,args);
	r *= 0.027901176166175;
	q += r;
	v.x = v0x + 0.0421382841643 * v1x + 0.7839656651012 * v2x;
	v.y = v0y + 0.0421382841643 * v1y + 0.7839656651012 * v2y;
	v.z = v0z + 0.0421382841643 * v1z + 0.7839656651012 * v2z;
	f(&v,&r,args);
	r *= 0.027901176166175;
	q += r;
	v.x = v0x + 0.7839656651013 * v1x + 0.0421382841642 * v2x;
	v.y = v0y + 0.7839656651013 * v1y + 0.0421382841642 * v2y;
	v.z = v0z + 0.7839656651013 * v1z + 0.0421382841642 * v2z;
	f(&v,&r,args);
	r *= 0.027901176166175;
	q += r;
	v.x = v0x + 0.7839656651013 * v1x + 0.1738960507345 * v2x;
	v.y = v0y + 0.7839656651013 * v1y + 0.1738960507345 * v2y;
	v.z = v0z + 0.7839656651013 * v1z + 0.1738960507345 * v2z;
	f(&v,&r,args);
	r *= 0.027901176166175;
	q += r;
	v.x = v0x + 0.0421382841643 * v1x + 0.1738960507345 * v2x;
	v.y = v0y + 0.0421382841643 * v1y + 0.1738960507345 * v2y;
	v.z = v0z + 0.0421382841643 * v1z + 0.1738960507345 * v2z;
	f(&v,&r,args);
	r *= 0.027901176166175;
	q += r;
	v.x = v0x + 0.1738960507346 * v1x + 0.7839656651012 * v2x;
	v.y = v0y + 0.1738960507346 * v1y + 0.7839656651012 * v2y;
	v.z = v0z + 0.1738960507346 * v1z + 0.7839656651012 * v2z;
	f(&v,&r,args);
	r *= 0.027901176166175;
	q += r;
	v.x = v0x + 0.0512238276496 * v1x + 0.4743880861752 * v2x;
	v.y = v0y + 0.0512238276496 * v1y + 0.4743880861752 * v2y;
	v.z = v0z + 0.0512238276496 * v1z + 0.4743880861752 * v2z;
	f(&v,&r,args);
	r *= 0.041994389883375;
	q += r;
	v.x = v0x + 0.4743880861751 * v1x + 0.0512238276497 * v2x;
	v.y = v0y + 0.4743880861751 * v1y + 0.0512238276497 * v2y;
	v.z = v0z + 0.4743880861751 * v1z + 0.0512238276497 * v2z;
	f(&v,&r,args);
	r *= 0.041994389883375;
	q += r;
	v.x = v0x + 0.4743880861751 * v1x + 0.4743880861752 * v2x;
	v.y = v0y + 0.4743880861751 * v1y + 0.4743880861752 * v2y;
	v.z = v0z + 0.4743880861751 * v1z + 0.4743880861752 * v2z;
	f(&v,&r,args);
	r *= 0.041994389883375;
	q += r;
	v.x = v0x + 0.238561530018 * v1x + 0.5228769399639 * v2x;
	v.y = v0y + 0.238561530018 * v1y + 0.5228769399639 * v2y;
	v.z = v0z + 0.238561530018 * v1z + 0.5228769399639 * v2z;
	f(&v,&r,args);
	r *= 0.06630597009865;
	q += r;
	v.x = v0x + 0.238561530018 * v1x + 0.2385615300181 * v2x;
	v.y = v0y + 0.238561530018 * v1y + 0.2385615300181 * v2y;
	v.z = v0z + 0.238561530018 * v1z + 0.2385615300181 * v2z;
	f(&v,&r,args);
	r *= 0.06630597009865;
	q += r;
	v.x = v0x + 0.5228769399638 * v1x + 0.2385615300181 * v2x;
	v.y = v0y + 0.5228769399638 * v1y + 0.2385615300181 * v2y;
	v.z = v0z + 0.5228769399638 * v1z + 0.2385615300181 * v2z;
	f(&v,&r,args);
	r *= 0.06630597009865;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss21(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	T q;
	T r;
	v.x = v0x + 0.9096219804312 * v1x + 0.0451890097844 * v2x;
	v.y = v0y + 0.9096219804312 * v1y + 0.0451890097844 * v2y;
	v.z = v0z + 0.9096219804312 * v1z + 0.0451890097844 * v2z;
	f(&v,&q,args);
	q *= 0.01299678551615;
	v.x = v0x + 0.0451890097844 * v1x + 0.9096219804312 * v2x;
	v.y = v0y + 0.0451890097844 * v1y + 0.9096219804312 * v2y;
	v.z = v0z + 0.0451890097844 * v1z + 0.9096219804312 * v2z;
	f(&v,&r,args);
	r *= 0.01299678551615;
	q += r;
	v.x = v0x + 0.0451890097844 * v1x + 0.0451890097844 * v2x;
	v.y = v0y + 0.0451890097844 * v1y + 0.0451890097844 * v2y;
	v.z = v0z + 0.0451890097844 * v1z + 0.0451890097844 * v2z;
	f(&v,&r,args);
	r *= 0.01299678551615;
	q += r;
	v.x = v0x + 0.2220631655373 * v1x + 0.0304243617288 * v2x;
	v.y = v0y + 0.2220631655373 * v1y + 0.0304243617288 * v2y;
	v.z = v0z + 0.2220631655373 * v1z + 0.0304243617288 * v2z;
	f(&v,&r,args);
	r *= 0.0176758525446;
	q += r;
	v.x = v0x + 0.7475124727339 * v1x + 0.0304243617288 * v2x;
	v.y = v0y + 0.7475124727339 * v1y + 0.0304243617288 * v2y;
	v.z = v0z + 0.7475124727339 * v1z + 0.0304243617288 * v2z;
	f(&v,&r,args);
	r *= 0.0176758525446;
	q += r;
	v.x = v0x + 0.0304243617288 * v1x + 0.2220631655373 * v2x;
	v.y = v0y + 0.0304243617288 * v1y + 0.2220631655373 * v2y;
	v.z = v0z + 0.0304243617288 * v1z + 0.2220631655373 * v2z;
	f(&v,&r,args);
	r *= 0.0176758525446;
	q += r;
	v.x = v0x + 0.0304243617288 * v1x + 0.7475124727339 * v2x;
	v.y = v0y + 0.0304243617288 * v1y + 0.7475124727339 * v2y;
	v.z = v0z + 0.0304243617288 * v1z + 0.7475124727339 * v2z;
	f(&v,&r,args);
	r *= 0.0176758525446;
	q += r;
	v.x = v0x + 0.2220631655373 * v1x + 0.7475124727339 * v2x;
	v.y = v0y + 0.2220631655373 * v1y + 0.7475124727339 * v2y;
	v.z = v0z + 0.2220631655373 * v1z + 0.7475124727339 * v2z;
	f(&v,&r,args);
	r *= 0.0176758525446;
	q += r;
	v.x = v0x + 0.7475124727339 * v1x + 0.2220631655373 * v2x;
	v.y = v0y + 0.7475124727339 * v1y + 0.2220631655373 * v2y;
	v.z = v0z + 0.7475124727339 * v1z + 0.2220631655373 * v2z;
	f(&v,&r,args);
	r *= 0.0176758525446;
	q += r;
	v.x = v0x + 0.6447187277637 * v1x + 0.2182900709714 * v2x;
	v.y = v0y + 0.6447187277637 * v1y + 0.2182900709714 * v2y;
	v.z = v0z + 0.6447187277637 * v1z + 0.2182900709714 * v2z;
	f(&v,&r,args);
	r *= 0.0227347690238;
	q += r;
	v.x = v0x + 0.1369912012649 * v1x + 0.2182900709714 * v2x;
	v.y = v0y + 0.1369912012649 * v1y + 0.2182900709714 * v2y;
	v.z = v0z + 0.1369912012649 * v1z + 0.2182900709714 * v2z;
	f(&v,&r,args);
	r *= 0.0227347690238;
	q += r;
	v.x = v0x + 0.2182900709714 * v1x + 0.6447187277637 * v2x;
	v.y = v0y + 0.2182900709714 * v1y + 0.6447187277637 * v2y;
	v.z = v0z + 0.2182900709714 * v1z + 0.6447187277637 * v2z;
	f(&v,&r,args);
	r *= 0.0227347690238;
	q += r;
	v.x = v0x + 0.1369912012649 * v1x + 0.6447187277637 * v2x;
	v.y = v0y + 0.1369912012649 * v1y + 0.6447187277637 * v2y;
	v.z = v0z + 0.1369912012649 * v1z + 0.6447187277637 * v2z;
	f(&v,&r,args);
	r *= 0.0227347690238;
	q += r;
	v.x = v0x + 0.6447187277637 * v1x + 0.1369912012649 * v2x;
	v.y = v0y + 0.6447187277637 * v1y + 0.1369912012649 * v2y;
	v.z = v0z + 0.6447187277637 * v1z + 0.1369912012649 * v2z;
	f(&v,&r,args);
	r *= 0.0227347690238;
	q += r;
	v.x = v0x + 0.2182900709714 * v1x + 0.1369912012649 * v2x;
	v.y = v0y + 0.2182900709714 * v1y + 0.1369912012649 * v2y;
	v.z = v0z + 0.2182900709714 * v1z + 0.1369912012649 * v2z;
	f(&v,&r,args);
	r *= 0.0227347690238;
	q += r;
	v.x = v0x + 0.4815198347833 * v1x + 0.4815198347833 * v2x;
	v.y = v0y + 0.4815198347833 * v1y + 0.4815198347833 * v2y;
	v.z = v0z + 0.4815198347833 * v1z + 0.4815198347833 * v2z;
	f(&v,&r,args);
	r *= 0.0258086012845;
	q += r;
	v.x = v0x + 0.4815198347833 * v1x + 0.0369603304334 * v2x;
	v.y = v0y + 0.4815198347833 * v1y + 0.0369603304334 * v2y;
	v.z = v0z + 0.4815198347833 * v1z + 0.0369603304334 * v2z;
	f(&v,&r,args);
	r *= 0.0258086012845;
	q += r;
	v.x = v0x + 0.0369603304333999 * v1x + 0.4815198347833 * v2x;
	v.y = v0y + 0.0369603304333999 * v1y + 0.4815198347833 * v2y;
	v.z = v0z + 0.0369603304333999 * v1z + 0.4815198347833 * v2z;
	f(&v,&r,args);
	r *= 0.0258086012845;
	q += r;
	v.x = v0x + 0.403603979818 * v1x + 0.1927920403641 * v2x;
	v.y = v0y + 0.403603979818 * v1y + 0.1927920403641 * v2y;
	v.z = v0z + 0.403603979818 * v1z + 0.1927920403641 * v2z;
	f(&v,&r,args);
	r *= 0.047040036729175;
	q += r;
	v.x = v0x + 0.1927920403642 * v1x + 0.4036039798179 * v2x;
	v.y = v0y + 0.1927920403642 * v1y + 0.4036039798179 * v2y;
	v.z = v0z + 0.1927920403642 * v1z + 0.4036039798179 * v2z;
	f(&v,&r,args);
	r *= 0.047040036729175;
	q += r;
	v.x = v0x + 0.403603979818 * v1x + 0.4036039798179 * v2x;
	v.y = v0y + 0.403603979818 * v1y + 0.4036039798179 * v2y;
	v.z = v0z + 0.403603979818 * v1z + 0.4036039798179 * v2z;
	f(&v,&r,args);
	r *= 0.047040036729175;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss36(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	T q;
	T r;
	v.x = v0x + 0.0264005354564 * v1x + 0.9493059293846 * v2x;
	v.y = v0y + 0.0264005354564 * v1y + 0.9493059293846 * v2y;
	v.z = v0z + 0.0264005354564 * v1z + 0.9493059293846 * v2z;
	f(&v,&q,args);
	q *= 0.004156024968925;
	v.x = v0x + 0.9492111441638 * v1x + 0.024269513064 * v2x;
	v.y = v0y + 0.9492111441638 * v1y + 0.024269513064 * v2y;
	v.z = v0z + 0.9492111441638 * v1z + 0.024269513064 * v2z;
	f(&v,&r,args);
	r *= 0.00417029249445;
	q += r;
	v.x = v0x + 0.0242806010012 * v1x + 0.0265067966437 * v2x;
	v.y = v0y + 0.0242806010012 * v1y + 0.0265067966437 * v2y;
	v.z = v0z + 0.0242806010012 * v1z + 0.0265067966437 * v2z;
	f(&v,&r,args);
	r *= 0.004170764226675;
	q += r;
	v.x = v0x + 0.5198907823888 * v1x + 0.4767316412363 * v2x;
	v.y = v0y + 0.5198907823888 * v1y + 0.4767316412363 * v2y;
	v.z = v0z + 0.5198907823888 * v1z + 0.4767316412363 * v2z;
	f(&v,&r,args);
	r *= 0.004392021752075;
	q += r;
	v.x = v0x + 0.00434058727969999 * v1x + 0.5198921829102 * v2x;
	v.y = v0y + 0.00434058727969999 * v1y + 0.5198921829102 * v2y;
	v.z = v0z + 0.00434058727969999 * v1z + 0.5198921829102 * v2z;
	f(&v,&r,args);
	r *= 0.004611866546125;
	q += r;
	v.x = v0x + 0.4753304100327 * v1x + 0.0055912706202 * v2x;
	v.y = v0y + 0.4753304100327 * v1y + 0.0055912706202 * v2y;
	v.z = v0z + 0.4753304100327 * v1z + 0.0055912706202 * v2z;
	f(&v,&r,args);
	r *= 0.0049485602547;
	q += r;
	v.x = v0x + 0.1249164206061 * v1x + 0.0133996048618 * v2x;
	v.y = v0y + 0.1249164206061 * v1y + 0.0133996048618 * v2y;
	v.z = v0z + 0.1249164206061 * v1z + 0.0133996048618 * v2z;
	f(&v,&r,args);
	r *= 0.005088509896375;
	q += r;
	v.x = v0x + 0.013773591874 * v1x + 0.8613054321334 * v2x;
	v.y = v0y + 0.013773591874 * v1y + 0.8613054321334 * v2y;
	v.z = v0z + 0.013773591874 * v1z + 0.8613054321334 * v2z;
	f(&v,&r,args);
	r *= 0.0051713215985;
	q += r;
	v.x = v0x + 0.8613700828781 * v1x + 0.1247733717358 * v2x;
	v.y = v0y + 0.8613700828781 * v1y + 0.1247733717358 * v2y;
	v.z = v0z + 0.8613700828781 * v1z + 0.1247733717358 * v2z;
	f(&v,&r,args);
	r *= 0.00520678415215;
	q += r;
	v.x = v0x + 0.1349674584555 * v1x + 0.8438438351223 * v2x;
	v.y = v0y + 0.1349674584555 * v1y + 0.8438438351223 * v2y;
	v.z = v0z + 0.1349674584555 * v1z + 0.8438438351223 * v2z;
	f(&v,&r,args);
	r *= 0.007945494456975;
	q += r;
	v.x = v0x + 0.0213139566951 * v1x + 0.135456364583 * v2x;
	v.y = v0y + 0.0213139566951 * v1y + 0.135456364583 * v2y;
	v.z = v0z + 0.0213139566951 * v1z + 0.135456364583 * v2z;
	f(&v,&r,args);
	r *= 0.008011800881025;
	q += r;
	v.x = v0x + 0.8432285381479 * v1x + 0.0213482820656 * v2x;
	v.y = v0y + 0.8432285381479 * v1y + 0.0213482820656 * v2y;
	v.z = v0z + 0.8432285381479 * v1z + 0.0213482820656 * v2z;
	f(&v,&r,args);
	r *= 0.00801519202865;
	q += r;
	v.x = v0x + 0.6689226826307 * v1x + 0.0221919663014 * v2x;
	v.y = v0y + 0.6689226826307 * v1y + 0.0221919663014 * v2y;
	v.z = v0z + 0.6689226826307 * v1z + 0.0221919663014 * v2z;
	f(&v,&r,args);
	r *= 0.010769148979575;
	q += r;
	v.x = v0x + 0.0225929525442 * v1x + 0.3089012879389 * v2x;
	v.y = v0y + 0.0225929525442 * v1y + 0.3089012879389 * v2y;
	v.z = v0z + 0.0225929525442 * v1z + 0.3089012879389 * v2z;
	f(&v,&r,args);
	r *= 0.010961835383475;
	q += r;
	v.x = v0x + 0.3081745044122 * v1x + 0.6691709943321 * v2x;
	v.y = v0y + 0.3081745044122 * v1y + 0.6691709943321 * v2y;
	v.z = v0z + 0.3081745044122 * v1z + 0.6691709943321 * v2z;
	f(&v,&r,args);
	r *= 0.010980241818325;
	q += r;
	v.x = v0x + 0.0266766436122 * v1x + 0.6924718155106 * v2x;
	v.y = v0y + 0.0266766436122 * v1y + 0.6924718155106 * v2y;
	v.z = v0z + 0.0266766436122 * v1z + 0.6924718155106 * v2z;
	f(&v,&r,args);
	r *= 0.011998798092275;
	q += r;
	v.x = v0x + 0.2808829905923 * v1x + 0.0268723345026 * v2x;
	v.y = v0y + 0.2808829905923 * v1y + 0.0268723345026 * v2y;
	v.z = v0z + 0.2808829905923 * v1z + 0.0268723345026 * v2z;
	f(&v,&r,args);
	r *= 0.012095156518325;
	q += r;
	v.x = v0x + 0.6921288579659 * v1x + 0.2810093973222 * v2x;
	v.y = v0y + 0.6921288579659 * v1y + 0.2810093973222 * v2y;
	v.z = v0z + 0.6921288579659 * v1z + 0.2810093973222 * v2z;
	f(&v,&r,args);
	r *= 0.012121685584375;
	q += r;
	v.x = v0x + 0.0884640100944001 * v1x + 0.7973581413586 * v2x;
	v.y = v0y + 0.0884640100944001 * v1y + 0.7973581413586 * v2y;
	v.z = v0z + 0.0884640100944001 * v1z + 0.7973581413586 * v2z;
	f(&v,&r,args);
	r *= 0.0139241122006;
	q += r;
	v.x = v0x + 0.1145385569148 * v1x + 0.0879806508791 * v2x;
	v.y = v0y + 0.1145385569148 * v1y + 0.0879806508791 * v2y;
	v.z = v0z + 0.1145385569148 * v1z + 0.0879806508791 * v2z;
	f(&v,&r,args);
	r *= 0.0140256591089;
	q += r;
	v.x = v0x + 0.7962172144978 * v1x + 0.1145020561128 * v2x;
	v.y = v0y + 0.7962172144978 * v1y + 0.1145020561128 * v2y;
	v.z = v0z + 0.7962172144978 * v1z + 0.1145020561128 * v2z;
	f(&v,&r,args);
	r *= 0.014129753092325;
	q += r;
	v.x = v0x + 0.2260607987623 * v1x + 0.6686904119922 * v2x;
	v.y = v0y + 0.2260607987623 * v1y + 0.6686904119922 * v2y;
	v.z = v0z + 0.2260607987623 * v1z + 0.6686904119922 * v2z;
	f(&v,&r,args);
	r *= 0.01723224726675;
	q += r;
	v.x = v0x + 0.1061926087428 * v1x + 0.2275051631832 * v2x;
	v.y = v0y + 0.1061926087428 * v1y + 0.2275051631832 * v2y;
	v.z = v0z + 0.1061926087428 * v1z + 0.2275051631832 * v2z;
	f(&v,&r,args);
	r *= 0.017930333402225;
	q += r;
	v.x = v0x + 0.6637623701232 * v1x + 0.1054572561221 * v2x;
	v.y = v0y + 0.6637623701232 * v1y + 0.1054572561221 * v2y;
	v.z = v0z + 0.6637623701232 * v1z + 0.1054572561221 * v2z;
	f(&v,&r,args);
	r *= 0.0181863480244;
	q += r;
	v.x = v0x + 0.3120876443802 * v1x + 0.5174064398658 * v2x;
	v.y = v0y + 0.3120876443802 * v1y + 0.5174064398658 * v2y;
	v.z = v0z + 0.3120876443802 * v1z + 0.5174064398658 * v2z;
	f(&v,&r,args);
	r *= 0.019720183418425;
	q += r;
	v.x = v0x + 0.1742882171748 * v1x + 0.3170523855209 * v2x;
	v.y = v0y + 0.1742882171748 * v1y + 0.3170523855209 * v2y;
	v.z = v0z + 0.1742882171748 * v1z + 0.3170523855209 * v2z;
	f(&v,&r,args);
	r *= 0.0202528586378;
	q += r;
	v.x = v0x + 0.504746977606 * v1x + 0.1810706361659 * v2x;
	v.y = v0y + 0.504746977606 * v1y + 0.1810706361659 * v2y;
	v.z = v0z + 0.504746977606 * v1z + 0.1810706361659 * v2z;
	f(&v,&r,args);
	r *= 0.020643132476375;
	q += r;
	v.x = v0x + 0.0703944642332 * v1x + 0.4678594539804 * v2x;
	v.y = v0y + 0.0703944642332 * v1y + 0.4678594539804 * v2y;
	v.z = v0z + 0.0703944642332 * v1z + 0.4678594539804 * v2z;
	f(&v,&r,args);
	r *= 0.02105111418325;
	q += r;
	v.x = v0x + 0.4684056461834 * v1x + 0.4622856042085 * v2x;
	v.y = v0y + 0.4684056461834 * v1y + 0.4622856042085 * v2y;
	v.z = v0z + 0.4684056461834 * v1z + 0.4622856042085 * v2z;
	f(&v,&r,args);
	r *= 0.021089638332625;
	q += r;
	v.x = v0x + 0.4623686935063 * v1x + 0.0724357805669 * v2x;
	v.y = v0y + 0.4623686935063 * v1y + 0.0724357805669 * v2y;
	v.z = v0z + 0.4623686935063 * v1z + 0.0724357805669 * v2z;
	f(&v,&r,args);
	r *= 0.0212992467122;
	q += r;
	v.x = v0x + 0.128997910293 * v1x + 0.6131395039177 * v2x;
	v.y = v0y + 0.128997910293 * v1y + 0.6131395039177 * v2y;
	v.z = v0z + 0.128997910293 * v1z + 0.6131395039177 * v2z;
	f(&v,&r,args);
	r *= 0.0225711332013;
	q += r;
	v.x = v0x + 0.2587011398612 * v1x + 0.1300360834609 * v2x;
	v.y = v0y + 0.2587011398612 * v1y + 0.1300360834609 * v2y;
	v.z = v0z + 0.2587011398612 * v1z + 0.1300360834609 * v2z;
	f(&v,&r,args);
	r *= 0.022857078587125;
	q += r;
	v.x = v0x + 0.6113104035182 * v1x + 0.2581713828884 * v2x;
	v.y = v0y + 0.6113104035182 * v1y + 0.2581713828884 * v2y;
	v.z = v0z + 0.6113104035182 * v1z + 0.2581713828884 * v2z;
	f(&v,&r,args);
	r *= 0.022906976635225;
	q += r;
	v.x = v0x + 0.3356556038355 * v1x + 0.2362005969817 * v2x;
	v.y = v0y + 0.3356556038355 * v1y + 0.2362005969817 * v2y;
	v.z = v0z + 0.3356556038355 * v1z + 0.2362005969817 * v2z;
	f(&v,&r,args);
	r *= 0.0256393343724;
	q += r;
	v.x = v0x + 0.2331977907682 * v1x + 0.4311026308588 * v2x;
	v.y = v0y + 0.2331977907682 * v1y + 0.4311026308588 * v2y;
	v.z = v0z + 0.2331977907682 * v1z + 0.4311026308588 * v2z;
	f(&v,&r,args);
	r *= 0.025828991535325;
	q += r;
	v.x = v0x + 0.4238561751788 * v1x + 0.3456013949376 * v2x;
	v.y = v0y + 0.4238561751788 * v1y + 0.3456013949376 * v2y;
	v.z = v0z + 0.4238561751788 * v1z + 0.3456013949376 * v2z;
	f(&v,&r,args);
	r *= 0.025896359179825;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss91(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	T q;
	T r;
	v.x = v0x + 0.9928951216156 * v1x + 0.00355243919220001 * v2x;
	v.y = v0y + 0.9928951216156 * v1y + 0.00355243919220001 * v2y;
	v.z = v0z + 0.9928951216156 * v1z + 0.00355243919220001 * v2z;
	f(&v,&q,args);
	q *= 0.000167610910975;
	v.x = v0x + 0.00355243919219994 * v1x + 0.9928951216156 * v2x;
	v.y = v0y + 0.00355243919219994 * v1y + 0.9928951216156 * v2y;
	v.z = v0z + 0.00355243919219994 * v1z + 0.9928951216156 * v2z;
	f(&v,&r,args);
	r *= 0.000167610910975;
	q += r;
	v.x = v0x + 0.00355243919219999 * v1x + 0.0035524391922 * v2x;
	v.y = v0y + 0.00355243919219999 * v1y + 0.0035524391922 * v2y;
	v.z = v0z + 0.00355243919219999 * v1z + 0.0035524391922 * v2z;
	f(&v,&r,args);
	r *= 0.000167610910975;
	q += r;
	v.x = v0x + 0.0358552797177 * v1x + 0.0087898929093 * v2x;
	v.y = v0y + 0.0358552797177 * v1y + 0.0087898929093 * v2y;
	v.z = v0z + 0.0358552797177 * v1z + 0.0087898929093 * v2z;
	f(&v,&r,args);
	r *= 0.00113681520185;
	q += r;
	v.x = v0x + 0.955354827373 * v1x + 0.00878989290929999 * v2x;
	v.y = v0y + 0.955354827373 * v1y + 0.00878989290929999 * v2y;
	v.z = v0z + 0.955354827373 * v1z + 0.00878989290929999 * v2z;
	f(&v,&r,args);
	r *= 0.00113681520185;
	q += r;
	v.x = v0x + 0.00878989290929996 * v1x + 0.0358552797177 * v2x;
	v.y = v0y + 0.00878989290929996 * v1y + 0.0358552797177 * v2y;
	v.z = v0z + 0.00878989290929996 * v1z + 0.0358552797177 * v2z;
	f(&v,&r,args);
	r *= 0.00113681520185;
	q += r;
	v.x = v0x + 0.955354827373 * v1x + 0.0358552797177 * v2x;
	v.y = v0y + 0.955354827373 * v1y + 0.0358552797177 * v2y;
	v.z = v0z + 0.955354827373 * v1z + 0.0358552797177 * v2z;
	f(&v,&r,args);
	r *= 0.00113681520185;
	q += r;
	v.x = v0x + 0.0358552797177 * v1x + 0.955354827373 * v2x;
	v.y = v0y + 0.0358552797177 * v1y + 0.955354827373 * v2y;
	v.z = v0z + 0.0358552797177 * v1z + 0.955354827373 * v2z;
	f(&v,&r,args);
	r *= 0.00113681520185;
	q += r;
	v.x = v0x + 0.00878989290929999 * v1x + 0.955354827373 * v2x;
	v.y = v0y + 0.00878989290929999 * v1y + 0.955354827373 * v2y;
	v.z = v0z + 0.00878989290929999 * v1z + 0.955354827373 * v2z;
	f(&v,&r,args);
	r *= 0.00113681520185;
	q += r;
	v.x = v0x + 0.00524053759359999 * v1x + 0.1082329745017 * v2x;
	v.y = v0y + 0.00524053759359999 * v1y + 0.1082329745017 * v2y;
	v.z = v0z + 0.00524053759359999 * v1z + 0.1082329745017 * v2z;
	f(&v,&r,args);
	r *= 0.001301939633;
	q += r;
	v.x = v0x + 0.1082329745018 * v1x + 0.0052405375935 * v2x;
	v.y = v0y + 0.1082329745018 * v1y + 0.0052405375935 * v2y;
	v.z = v0z + 0.1082329745018 * v1z + 0.0052405375935 * v2z;
	f(&v,&r,args);
	r *= 0.001301939633;
	q += r;
	v.x = v0x + 0.8865264879048 * v1x + 0.1082329745017 * v2x;
	v.y = v0y + 0.8865264879048 * v1y + 0.1082329745017 * v2y;
	v.z = v0z + 0.8865264879048 * v1z + 0.1082329745017 * v2z;
	f(&v,&r,args);
	r *= 0.001301939633;
	q += r;
	v.x = v0x + 0.1082329745018 * v1x + 0.8865264879047 * v2x;
	v.y = v0y + 0.1082329745018 * v1y + 0.8865264879047 * v2y;
	v.z = v0z + 0.1082329745018 * v1z + 0.8865264879047 * v2z;
	f(&v,&r,args);
	r *= 0.001301939633;
	q += r;
	v.x = v0x + 0.00524053759359999 * v1x + 0.8865264879047 * v2x;
	v.y = v0y + 0.00524053759359999 * v1y + 0.8865264879047 * v2y;
	v.z = v0z + 0.00524053759359999 * v1z + 0.8865264879047 * v2z;
	f(&v,&r,args);
	r *= 0.001301939633;
	q += r;
	v.x = v0x + 0.8865264879048 * v1x + 0.0052405375935 * v2x;
	v.y = v0y + 0.8865264879048 * v1y + 0.0052405375935 * v2y;
	v.z = v0z + 0.8865264879048 * v1z + 0.0052405375935 * v2z;
	f(&v,&r,args);
	r *= 0.001301939633;
	q += r;
	v.x = v0x + 0.046639743215 * v1x + 0.90672051357 * v2x;
	v.y = v0y + 0.046639743215 * v1y + 0.90672051357 * v2y;
	v.z = v0z + 0.046639743215 * v1z + 0.90672051357 * v2z;
	f(&v,&r,args);
	r *= 0.001635885822175;
	q += r;
	v.x = v0x + 0.90672051357 * v1x + 0.046639743215 * v2x;
	v.y = v0y + 0.90672051357 * v1y + 0.046639743215 * v2y;
	v.z = v0z + 0.90672051357 * v1z + 0.046639743215 * v2z;
	f(&v,&r,args);
	r *= 0.001635885822175;
	q += r;
	v.x = v0x + 0.0466397432149999 * v1x + 0.046639743215 * v2x;
	v.y = v0y + 0.0466397432149999 * v1y + 0.046639743215 * v2y;
	v.z = v0z + 0.0466397432149999 * v1z + 0.046639743215 * v2z;
	f(&v,&r,args);
	r *= 0.001635885822175;
	q += r;
	v.x = v0x + 0.784152030177 * v1x + 0.00827592412839998 * v2x;
	v.y = v0y + 0.784152030177 * v1y + 0.00827592412839998 * v2y;
	v.z = v0z + 0.784152030177 * v1z + 0.00827592412839998 * v2z;
	f(&v,&r,args);
	r *= 0.002318446038325;
	q += r;
	v.x = v0x + 0.00827592412840006 * v1x + 0.784152030177 * v2x;
	v.y = v0y + 0.00827592412840006 * v1y + 0.784152030177 * v2y;
	v.z = v0z + 0.00827592412840006 * v1z + 0.784152030177 * v2z;
	f(&v,&r,args);
	r *= 0.002318446038325;
	q += r;
	v.x = v0x + 0.00827592412840003 * v1x + 0.2075720456946 * v2x;
	v.y = v0y + 0.00827592412840003 * v1y + 0.2075720456946 * v2y;
	v.z = v0z + 0.00827592412840003 * v1z + 0.2075720456946 * v2z;
	f(&v,&r,args);
	r *= 0.002318446038325;
	q += r;
	v.x = v0x + 0.2075720456946 * v1x + 0.784152030177 * v2x;
	v.y = v0y + 0.2075720456946 * v1y + 0.784152030177 * v2y;
	v.z = v0z + 0.2075720456946 * v1z + 0.784152030177 * v2z;
	f(&v,&r,args);
	r *= 0.002318446038325;
	q += r;
	v.x = v0x + 0.784152030177 * v1x + 0.2075720456946 * v2x;
	v.y = v0y + 0.784152030177 * v1y + 0.2075720456946 * v2y;
	v.z = v0z + 0.784152030177 * v1z + 0.2075720456946 * v2z;
	f(&v,&r,args);
	r *= 0.002318446038325;
	q += r;
	v.x = v0x + 0.2075720456946 * v1x + 0.0082759241284 * v2x;
	v.y = v0y + 0.2075720456946 * v1y + 0.0082759241284 * v2y;
	v.z = v0z + 0.2075720456946 * v1z + 0.0082759241284 * v2z;
	f(&v,&r,args);
	r *= 0.002318446038325;
	q += r;
	v.x = v0x + 0.8827043562574 * v1x + 0.0314836947701 * v2x;
	v.y = v0y + 0.8827043562574 * v1y + 0.0314836947701 * v2y;
	v.z = v0z + 0.8827043562574 * v1z + 0.0314836947701 * v2z;
	f(&v,&r,args);
	r *= 0.002398444565575;
	q += r;
	v.x = v0x + 0.0858119489725001 * v1x + 0.0314836947701 * v2x;
	v.y = v0y + 0.0858119489725001 * v1y + 0.0314836947701 * v2y;
	v.z = v0z + 0.0858119489725001 * v1z + 0.0314836947701 * v2z;
	f(&v,&r,args);
	r *= 0.002398444565575;
	q += r;
	v.x = v0x + 0.8827043562574 * v1x + 0.0858119489725 * v2x;
	v.y = v0y + 0.8827043562574 * v1y + 0.0858119489725 * v2y;
	v.z = v0z + 0.8827043562574 * v1z + 0.0858119489725 * v2z;
	f(&v,&r,args);
	r *= 0.002398444565575;
	q += r;
	v.x = v0x + 0.0314836947701 * v1x + 0.8827043562574 * v2x;
	v.y = v0y + 0.0314836947701 * v1y + 0.8827043562574 * v2y;
	v.z = v0z + 0.0314836947701 * v1z + 0.8827043562574 * v2z;
	f(&v,&r,args);
	r *= 0.002398444565575;
	q += r;
	v.x = v0x + 0.0314836947701 * v1x + 0.0858119489725 * v2x;
	v.y = v0y + 0.0314836947701 * v1y + 0.0858119489725 * v2y;
	v.z = v0z + 0.0314836947701 * v1z + 0.0858119489725 * v2z;
	f(&v,&r,args);
	r *= 0.002398444565575;
	q += r;
	v.x = v0x + 0.0858119489725 * v1x + 0.8827043562574 * v2x;
	v.y = v0y + 0.0858119489725 * v1y + 0.8827043562574 * v2y;
	v.z = v0z + 0.0858119489725 * v1z + 0.8827043562574 * v2z;
	f(&v,&r,args);
	r *= 0.002398444565575;
	q += r;
	v.x = v0x + 0.3216071005549 * v1x + 0.0095150760625 * v2x;
	v.y = v0y + 0.3216071005549 * v1y + 0.0095150760625 * v2y;
	v.z = v0z + 0.3216071005549 * v1z + 0.0095150760625 * v2z;
	f(&v,&r,args);
	r *= 0.002856195229175;
	q += r;
	v.x = v0x + 0.6688778233825 * v1x + 0.321607100555 * v2x;
	v.y = v0y + 0.6688778233825 * v1y + 0.321607100555 * v2y;
	v.z = v0z + 0.6688778233825 * v1z + 0.321607100555 * v2z;
	f(&v,&r,args);
	r *= 0.002856195229175;
	q += r;
	v.x = v0x + 0.3216071005549 * v1x + 0.6688778233826 * v2x;
	v.y = v0y + 0.3216071005549 * v1y + 0.6688778233826 * v2y;
	v.z = v0z + 0.3216071005549 * v1z + 0.6688778233826 * v2z;
	f(&v,&r,args);
	r *= 0.002856195229175;
	q += r;
	v.x = v0x + 0.00951507606239993 * v1x + 0.321607100555 * v2x;
	v.y = v0y + 0.00951507606239993 * v1y + 0.321607100555 * v2y;
	v.z = v0z + 0.00951507606239993 * v1z + 0.321607100555 * v2z;
	f(&v,&r,args);
	r *= 0.002856195229175;
	q += r;
	v.x = v0x + 0.00951507606239987 * v1x + 0.6688778233826 * v2x;
	v.y = v0y + 0.00951507606239987 * v1y + 0.6688778233826 * v2y;
	v.z = v0z + 0.00951507606239987 * v1z + 0.6688778233826 * v2z;
	f(&v,&r,args);
	r *= 0.002856195229175;
	q += r;
	v.x = v0x + 0.6688778233825 * v1x + 0.00951507606250002 * v2x;
	v.y = v0y + 0.6688778233825 * v1y + 0.00951507606250002 * v2y;
	v.z = v0z + 0.6688778233825 * v1z + 0.00951507606250002 * v2z;
	f(&v,&r,args);
	r *= 0.002856195229175;
	q += r;
	v.x = v0x + 0.5520140671206 * v1x + 0.00998597856810002 * v2x;
	v.y = v0y + 0.5520140671206 * v1y + 0.00998597856810002 * v2y;
	v.z = v0z + 0.5520140671206 * v1z + 0.00998597856810002 * v2z;
	f(&v,&r,args);
	r *= 0.00293042410435;
	q += r;
	v.x = v0x + 0.4379999543113 * v1x + 0.5520140671206 * v2x;
	v.y = v0y + 0.4379999543113 * v1y + 0.5520140671206 * v2y;
	v.z = v0z + 0.4379999543113 * v1z + 0.5520140671206 * v2z;
	f(&v,&r,args);
	r *= 0.00293042410435;
	q += r;
	v.x = v0x + 0.00998597856810002 * v1x + 0.5520140671206 * v2x;
	v.y = v0y + 0.00998597856810002 * v1y + 0.5520140671206 * v2y;
	v.z = v0z + 0.00998597856810002 * v1z + 0.5520140671206 * v2z;
	f(&v,&r,args);
	r *= 0.00293042410435;
	q += r;
	v.x = v0x + 0.5520140671206 * v1x + 0.4379999543113 * v2x;
	v.y = v0y + 0.5520140671206 * v1y + 0.4379999543113 * v2y;
	v.z = v0z + 0.5520140671206 * v1z + 0.4379999543113 * v2z;
	f(&v,&r,args);
	r *= 0.00293042410435;
	q += r;
	v.x = v0x + 0.00998597856810002 * v1x + 0.4379999543113 * v2x;
	v.y = v0y + 0.00998597856810002 * v1y + 0.4379999543113 * v2y;
	v.z = v0z + 0.00998597856810002 * v1z + 0.4379999543113 * v2z;
	f(&v,&r,args);
	r *= 0.00293042410435;
	q += r;
	v.x = v0x + 0.4379999543113 * v1x + 0.0099859785681 * v2x;
	v.y = v0y + 0.4379999543113 * v1y + 0.0099859785681 * v2y;
	v.z = v0z + 0.4379999543113 * v1z + 0.0099859785681 * v2z;
	f(&v,&r,args);
	r *= 0.00293042410435;
	q += r;
	v.x = v0x + 0.1619974933733 * v1x + 0.0405093994119 * v2x;
	v.y = v0y + 0.1619974933733 * v1y + 0.0405093994119 * v2y;
	v.z = v0z + 0.1619974933733 * v1z + 0.0405093994119 * v2z;
	f(&v,&r,args);
	r *= 0.0047049288808;
	q += r;
	v.x = v0x + 0.7974931072147 * v1x + 0.1619974933734 * v2x;
	v.y = v0y + 0.7974931072147 * v1y + 0.1619974933734 * v2y;
	v.z = v0z + 0.7974931072147 * v1z + 0.1619974933734 * v2z;
	f(&v,&r,args);
	r *= 0.0047049288808;
	q += r;
	v.x = v0x + 0.1619974933733 * v1x + 0.7974931072148 * v2x;
	v.y = v0y + 0.1619974933733 * v1y + 0.7974931072148 * v2y;
	v.z = v0z + 0.1619974933733 * v1z + 0.7974931072148 * v2z;
	f(&v,&r,args);
	r *= 0.0047049288808;
	q += r;
	v.x = v0x + 0.0405093994118 * v1x + 0.7974931072148 * v2x;
	v.y = v0y + 0.0405093994118 * v1y + 0.7974931072148 * v2y;
	v.z = v0z + 0.0405093994118 * v1z + 0.7974931072148 * v2z;
	f(&v,&r,args);
	r *= 0.0047049288808;
	q += r;
	v.x = v0x + 0.0405093994118 * v1x + 0.1619974933734 * v2x;
	v.y = v0y + 0.0405093994118 * v1y + 0.1619974933734 * v2y;
	v.z = v0z + 0.0405093994118 * v1z + 0.1619974933734 * v2z;
	f(&v,&r,args);
	r *= 0.0047049288808;
	q += r;
	v.x = v0x + 0.7974931072147 * v1x + 0.0405093994119 * v2x;
	v.y = v0y + 0.7974931072147 * v1y + 0.0405093994119 * v2y;
	v.z = v0z + 0.7974931072147 * v1z + 0.0405093994119 * v2z;
	f(&v,&r,args);
	r *= 0.0047049288808;
	q += r;
	v.x = v0x + 0.227156889609 * v1x + 0.3864215551955 * v2x;
	v.y = v0y + 0.227156889609 * v1y + 0.3864215551955 * v2y;
	v.z = v0z + 0.227156889609 * v1z + 0.3864215551955 * v2z;
	f(&v,&r,args);
	r *= 0.005881524506775;
	q += r;
	v.x = v0x + 0.3864215551955 * v1x + 0.227156889609 * v2x;
	v.y = v0y + 0.3864215551955 * v1y + 0.227156889609 * v2y;
	v.z = v0z + 0.3864215551955 * v1z + 0.227156889609 * v2z;
	f(&v,&r,args);
	r *= 0.005881524506775;
	q += r;
	v.x = v0x + 0.3864215551955 * v1x + 0.3864215551955 * v2x;
	v.y = v0y + 0.3864215551955 * v1y + 0.3864215551955 * v2y;
	v.z = v0z + 0.3864215551955 * v1z + 0.3864215551955 * v2z;
	f(&v,&r,args);
	r *= 0.005881524506775;
	q += r;
	v.x = v0x + 0.0954935310335 * v1x + 0.0954935310336 * v2x;
	v.y = v0y + 0.0954935310335 * v1y + 0.0954935310336 * v2y;
	v.z = v0z + 0.0954935310335 * v1z + 0.0954935310336 * v2z;
	f(&v,&r,args);
	r *= 0.005889286653775;
	q += r;
	v.x = v0x + 0.0954935310335 * v1x + 0.8090129379329 * v2x;
	v.y = v0y + 0.0954935310335 * v1y + 0.8090129379329 * v2y;
	v.z = v0z + 0.0954935310335 * v1z + 0.8090129379329 * v2z;
	f(&v,&r,args);
	r *= 0.005889286653775;
	q += r;
	v.x = v0x + 0.8090129379328 * v1x + 0.0954935310336 * v2x;
	v.y = v0y + 0.8090129379328 * v1y + 0.0954935310336 * v2y;
	v.z = v0z + 0.8090129379328 * v1z + 0.0954935310336 * v2z;
	f(&v,&r,args);
	r *= 0.005889286653775;
	q += r;
	v.x = v0x + 0.6774734280561 * v1x + 0.0479840480721 * v2x;
	v.y = v0y + 0.6774734280561 * v1y + 0.0479840480721 * v2y;
	v.z = v0z + 0.6774734280561 * v1z + 0.0479840480721 * v2z;
	f(&v,&r,args);
	r *= 0.00670615518575;
	q += r;
	v.x = v0x + 0.2745425238718 * v1x + 0.6774734280561 * v2x;
	v.y = v0y + 0.2745425238718 * v1y + 0.6774734280561 * v2y;
	v.z = v0z + 0.2745425238718 * v1z + 0.6774734280561 * v2z;
	f(&v,&r,args);
	r *= 0.00670615518575;
	q += r;
	v.x = v0x + 0.2745425238718 * v1x + 0.0479840480721 * v2x;
	v.y = v0y + 0.2745425238718 * v1y + 0.0479840480721 * v2y;
	v.z = v0z + 0.2745425238718 * v1z + 0.0479840480721 * v2z;
	f(&v,&r,args);
	r *= 0.00670615518575;
	q += r;
	v.x = v0x + 0.0479840480721 * v1x + 0.2745425238718 * v2x;
	v.y = v0y + 0.0479840480721 * v1y + 0.2745425238718 * v2y;
	v.z = v0z + 0.0479840480721 * v1z + 0.2745425238718 * v2z;
	f(&v,&r,args);
	r *= 0.00670615518575;
	q += r;
	v.x = v0x + 0.0479840480721 * v1x + 0.6774734280561 * v2x;
	v.y = v0y + 0.0479840480721 * v1y + 0.6774734280561 * v2y;
	v.z = v0z + 0.0479840480721 * v1z + 0.6774734280561 * v2z;
	f(&v,&r,args);
	r *= 0.00670615518575;
	q += r;
	v.x = v0x + 0.6774734280561 * v1x + 0.2745425238718 * v2x;
	v.y = v0y + 0.6774734280561 * v1y + 0.2745425238718 * v2y;
	v.z = v0z + 0.6774734280561 * v1z + 0.2745425238718 * v2z;
	f(&v,&r,args);
	r *= 0.00670615518575;
	q += r;
	v.x = v0x + 0.0516677930989 * v1x + 0.5429849622344 * v2x;
	v.y = v0y + 0.0516677930989 * v1y + 0.5429849622344 * v2y;
	v.z = v0z + 0.0516677930989 * v1z + 0.5429849622344 * v2z;
	f(&v,&r,args);
	r *= 0.007857244419475;
	q += r;
	v.x = v0x + 0.5429849622344 * v1x + 0.4053472446667 * v2x;
	v.y = v0y + 0.5429849622344 * v1y + 0.4053472446667 * v2y;
	v.z = v0z + 0.5429849622344 * v1z + 0.4053472446667 * v2z;
	f(&v,&r,args);
	r *= 0.007857244419475;
	q += r;
	v.x = v0x + 0.5429849622344 * v1x + 0.0516677930989 * v2x;
	v.y = v0y + 0.5429849622344 * v1y + 0.0516677930989 * v2y;
	v.z = v0z + 0.5429849622344 * v1z + 0.0516677930989 * v2z;
	f(&v,&r,args);
	r *= 0.007857244419475;
	q += r;
	v.x = v0x + 0.4053472446667 * v1x + 0.0516677930989 * v2x;
	v.y = v0y + 0.4053472446667 * v1y + 0.0516677930989 * v2y;
	v.z = v0z + 0.4053472446667 * v1z + 0.0516677930989 * v2z;
	f(&v,&r,args);
	r *= 0.007857244419475;
	q += r;
	v.x = v0x + 0.4053472446667 * v1x + 0.5429849622344 * v2x;
	v.y = v0y + 0.4053472446667 * v1y + 0.5429849622344 * v2y;
	v.z = v0z + 0.4053472446667 * v1z + 0.5429849622344 * v2z;
	f(&v,&r,args);
	r *= 0.007857244419475;
	q += r;
	v.x = v0x + 0.0516677930989 * v1x + 0.4053472446667 * v2x;
	v.y = v0y + 0.0516677930989 * v1y + 0.4053472446667 * v2y;
	v.z = v0z + 0.0516677930989 * v1z + 0.4053472446667 * v2z;
	f(&v,&r,args);
	r *= 0.007857244419475;
	q += r;
	v.x = v0x + 0.7054113116873 * v1x + 0.1068148267588 * v2x;
	v.y = v0y + 0.7054113116873 * v1y + 0.1068148267588 * v2y;
	v.z = v0z + 0.7054113116873 * v1z + 0.1068148267588 * v2z;
	f(&v,&r,args);
	r *= 0.008429904803975;
	q += r;
	v.x = v0x + 0.1068148267589 * v1x + 0.1877738615539 * v2x;
	v.y = v0y + 0.1068148267589 * v1y + 0.1877738615539 * v2y;
	v.z = v0z + 0.1068148267589 * v1z + 0.1877738615539 * v2z;
	f(&v,&r,args);
	r *= 0.008429904803975;
	q += r;
	v.x = v0x + 0.187773861554 * v1x + 0.1068148267588 * v2x;
	v.y = v0y + 0.187773861554 * v1y + 0.1068148267588 * v2y;
	v.z = v0z + 0.187773861554 * v1z + 0.1068148267588 * v2z;
	f(&v,&r,args);
	r *= 0.008429904803975;
	q += r;
	v.x = v0x + 0.187773861554 * v1x + 0.7054113116872 * v2x;
	v.y = v0y + 0.187773861554 * v1y + 0.7054113116872 * v2y;
	v.z = v0z + 0.187773861554 * v1z + 0.7054113116872 * v2z;
	f(&v,&r,args);
	r *= 0.008429904803975;
	q += r;
	v.x = v0x + 0.1068148267589 * v1x + 0.7054113116872 * v2x;
	v.y = v0y + 0.1068148267589 * v1y + 0.7054113116872 * v2y;
	v.z = v0z + 0.1068148267589 * v1z + 0.7054113116872 * v2z;
	f(&v,&r,args);
	r *= 0.008429904803975;
	q += r;
	v.x = v0x + 0.7054113116873 * v1x + 0.1877738615539 * v2x;
	v.y = v0y + 0.7054113116873 * v1y + 0.1877738615539 * v2y;
	v.z = v0z + 0.7054113116873 * v1z + 0.1877738615539 * v2z;
	f(&v,&r,args);
	r *= 0.008429904803975;
	q += r;
	v.x = v0x + 0.5747817297348 * v1x + 0.3057122990643 * v2x;
	v.y = v0y + 0.5747817297348 * v1y + 0.3057122990643 * v2y;
	v.z = v0z + 0.5747817297348 * v1z + 0.3057122990643 * v2z;
	f(&v,&r,args);
	r *= 0.010693632355325;
	q += r;
	v.x = v0x + 0.3057122990643 * v1x + 0.5747817297348 * v2x;
	v.y = v0y + 0.3057122990643 * v1y + 0.5747817297348 * v2y;
	v.z = v0z + 0.3057122990643 * v1z + 0.5747817297348 * v2z;
	f(&v,&r,args);
	r *= 0.010693632355325;
	q += r;
	v.x = v0x + 0.3057122990643 * v1x + 0.1195059712009 * v2x;
	v.y = v0y + 0.3057122990643 * v1y + 0.1195059712009 * v2y;
	v.z = v0z + 0.3057122990643 * v1z + 0.1195059712009 * v2z;
	f(&v,&r,args);
	r *= 0.010693632355325;
	q += r;
	v.x = v0x + 0.1195059712009 * v1x + 0.3057122990643 * v2x;
	v.y = v0y + 0.1195059712009 * v1y + 0.3057122990643 * v2y;
	v.z = v0z + 0.1195059712009 * v1z + 0.3057122990643 * v2z;
	f(&v,&r,args);
	r *= 0.010693632355325;
	q += r;
	v.x = v0x + 0.1195059712009 * v1x + 0.5747817297348 * v2x;
	v.y = v0y + 0.1195059712009 * v1y + 0.5747817297348 * v2y;
	v.z = v0z + 0.1195059712009 * v1z + 0.5747817297348 * v2z;
	f(&v,&r,args);
	r *= 0.010693632355325;
	q += r;
	v.x = v0x + 0.5747817297348 * v1x + 0.1195059712009 * v2x;
	v.y = v0y + 0.5747817297348 * v1y + 0.1195059712009 * v2y;
	v.z = v0z + 0.5747817297348 * v1z + 0.1195059712009 * v2z;
	f(&v,&r,args);
	r *= 0.010693632355325;
	q += r;
	v.x = v0x + 0.2009377128318 * v1x + 0.2009377128319 * v2x;
	v.y = v0y + 0.2009377128318 * v1y + 0.2009377128319 * v2y;
	v.z = v0z + 0.2009377128318 * v1z + 0.2009377128319 * v2z;
	f(&v,&r,args);
	r *= 0.011028473318425;
	q += r;
	v.x = v0x + 0.2009377128318 * v1x + 0.5981245743363 * v2x;
	v.y = v0y + 0.2009377128318 * v1y + 0.5981245743363 * v2y;
	v.z = v0z + 0.2009377128318 * v1z + 0.5981245743363 * v2z;
	f(&v,&r,args);
	r *= 0.011028473318425;
	q += r;
	v.x = v0x + 0.5981245743362 * v1x + 0.2009377128319 * v2x;
	v.y = v0y + 0.5981245743362 * v1y + 0.2009377128319 * v2y;
	v.z = v0z + 0.5981245743362 * v1z + 0.2009377128319 * v2z;
	f(&v,&r,args);
	r *= 0.011028473318425;
	q += r;
	v.x = v0x + 0.4717864543322 * v1x + 0.3121360256673 * v2x;
	v.y = v0y + 0.4717864543322 * v1y + 0.3121360256673 * v2y;
	v.z = v0z + 0.4717864543322 * v1z + 0.3121360256673 * v2z;
	f(&v,&r,args);
	r *= 0.0115367398671;
	q += r;
	v.x = v0x + 0.4717864543322 * v1x + 0.2160775200005 * v2x;
	v.y = v0y + 0.4717864543322 * v1y + 0.2160775200005 * v2y;
	v.z = v0z + 0.4717864543322 * v1z + 0.2160775200005 * v2z;
	f(&v,&r,args);
	r *= 0.0115367398671;
	q += r;
	v.x = v0x + 0.3121360256674 * v1x + 0.4717864543321 * v2x;
	v.y = v0y + 0.3121360256674 * v1y + 0.4717864543321 * v2y;
	v.z = v0z + 0.3121360256674 * v1z + 0.4717864543321 * v2z;
	f(&v,&r,args);
	r *= 0.0115367398671;
	q += r;
	v.x = v0x + 0.2160775200006 * v1x + 0.4717864543321 * v2x;
	v.y = v0y + 0.2160775200006 * v1y + 0.4717864543321 * v2y;
	v.z = v0z + 0.2160775200006 * v1z + 0.4717864543321 * v2z;
	f(&v,&r,args);
	r *= 0.0115367398671;
	q += r;
	v.x = v0x + 0.2160775200006 * v1x + 0.3121360256673 * v2x;
	v.y = v0y + 0.2160775200006 * v1y + 0.3121360256673 * v2y;
	v.z = v0z + 0.2160775200006 * v1z + 0.3121360256673 * v2z;
	f(&v,&r,args);
	r *= 0.0115367398671;
	q += r;
	v.x = v0x + 0.3121360256674 * v1x + 0.2160775200005 * v2x;
	v.y = v0y + 0.3121360256674 * v1y + 0.2160775200005 * v2y;
	v.z = v0z + 0.3121360256674 * v1z + 0.2160775200005 * v2z;
	f(&v,&r,args);
	r *= 0.0115367398671;
	q += r;
	v.x = v0x + 0.1246840192302 * v1x + 0.4376579903849 * v2x;
	v.y = v0y + 0.1246840192302 * v1y + 0.4376579903849 * v2y;
	v.z = v0z + 0.1246840192302 * v1z + 0.4376579903849 * v2z;
	f(&v,&r,args);
	r *= 0.0117288117156;
	q += r;
	v.x = v0x + 0.4376579903848 * v1x + 0.1246840192303 * v2x;
	v.y = v0y + 0.4376579903848 * v1y + 0.1246840192303 * v2y;
	v.z = v0z + 0.4376579903848 * v1z + 0.1246840192303 * v2z;
	f(&v,&r,args);
	r *= 0.0117288117156;
	q += r;
	v.x = v0x + 0.4376579903848 * v1x + 0.4376579903849 * v2x;
	v.y = v0y + 0.4376579903848 * v1y + 0.4376579903849 * v2y;
	v.z = v0z + 0.4376579903848 * v1z + 0.4376579903849 * v2z;
	f(&v,&r,args);
	r *= 0.0117288117156;
	q += r;
	v.x = v0x + 0.3333333333334 * v1x + 0.3333333333333 * v2x;
	v.y = v0y + 0.3333333333334 * v1y + 0.3333333333333 * v2y;
	v.z = v0z + 0.3333333333334 * v1z + 0.3333333333333 * v2z;
	f(&v,&r,args);
	r *= 0.013779999508675;
	q += r;
	return q;
}

template<class T, class F>
T quadgauss105(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
	Vector3 v0;
	Vector3 v(0.0,0.0,0.0);
	if(v0in == NULL) v0 = v; else v0 = *v0in;
	Real v0x = v0.x;
	Real v0y = v0.y;
	Real v0z = v0.z;
	Real v1x = v1.x;
	Real v1y = v1.y;
	Real v1z = v1.z;
	Real v2x = v2.x;
	Real v2y = v2.y;
	Real v2z = v2.z;
	T q;
	T r;
	v.x = v0x + 0.000851425939200068 * v1x + 0.9903676436772 * v2x;
	v.y = v0y + 0.000851425939200068 * v1y + 0.9903676436772 * v2y;
	v.z = v0z + 0.000851425939200068 * v1z + 0.9903676436772 * v2z;
	f(&v,&q,args);
	q *= 0.000160957456525;
	v.x = v0x + 0.000851546954800041 * v1x + 0.0087809216232 * v2x;
	v.y = v0y + 0.000851546954800041 * v1y + 0.0087809216232 * v2y;
	v.z = v0z + 0.000851546954800041 * v1z + 0.0087809216232 * v2z;
	f(&v,&r,args);
	r *= 0.0001609603269;
	q += r;
	v.x = v0x + 0.9637056319111 * v1x + 0.0335914404439 * v2x;
	v.y = v0y + 0.9637056319111 * v1y + 0.0335914404439 * v2y;
	v.z = v0z + 0.9637056319111 * v1z + 0.0335914404439 * v2z;
	f(&v,&r,args);
	r *= 0.00025336839275;
	q += r;
	v.x = v0x + 0.9637061838766 * v1x + 0.00270289467100001 * v2x;
	v.y = v0y + 0.9637061838766 * v1y + 0.00270289467100001 * v2y;
	v.z = v0z + 0.9637061838766 * v1z + 0.00270289467100001 * v2z;
	f(&v,&r,args);
	r *= 0.0002533688144;
	q += r;
	v.x = v0x + 0.9816648578343 * v1x + 0.00916763530509997 * v2x;
	v.y = v0y + 0.9816648578343 * v1y + 0.00916763530509997 * v2y;
	v.z = v0z + 0.9816648578343 * v1z + 0.00916763530509997 * v2z;
	f(&v,&r,args);
	r *= 0.000491998248375;
	q += r;
	v.x = v0x + 0.0239694640786 * v1x + 0.0084737176656 * v2x;
	v.y = v0y + 0.0239694640786 * v1y + 0.0084737176656 * v2y;
	v.z = v0z + 0.0239694640786 * v1z + 0.0084737176656 * v2z;
	f(&v,&r,args);
	r *= 0.0008366828446;
	q += r;
	v.x = v0x + 0.0239693363967001 * v1x + 0.9675569435345 * v2x;
	v.y = v0y + 0.0239693363967001 * v1y + 0.9675569435345 * v2y;
	v.z = v0z + 0.0239693363967001 * v1z + 0.9675569435345 * v2z;
	f(&v,&r,args);
	r *= 0.0008366834802;
	q += r;
	v.x = v0x + 0.9244433107346 * v1x + 0.0676784943862 * v2x;
	v.y = v0y + 0.9244433107346 * v1y + 0.0676784943862 * v2y;
	v.z = v0z + 0.9244433107346 * v1z + 0.0676784943862 * v2z;
	f(&v,&r,args);
	r *= 0.001071833084375;
	q += r;
	v.x = v0x + 0.9244432863009 * v1x + 0.00787816592909999 * v2x;
	v.y = v0y + 0.9244432863009 * v1y + 0.00787816592909999 * v2y;
	v.z = v0z + 0.9244432863009 * v1z + 0.00787816592909999 * v2z;
	f(&v,&r,args);
	r *= 0.001071836497125;
	q += r;
	v.x = v0x + 0.00867585037660002 * v1x + 0.0442974541187 * v2x;
	v.y = v0y + 0.00867585037660002 * v1y + 0.0442974541187 * v2y;
	v.z = v0z + 0.00867585037660002 * v1z + 0.0442974541187 * v2z;
	f(&v,&r,args);
	r *= 0.0010750950343;
	q += r;
	v.x = v0x + 0.00867585678329996 * v1x + 0.9470266676487 * v2x;
	v.y = v0y + 0.00867585678329996 * v1y + 0.9470266676487 * v2y;
	v.z = v0z + 0.00867585678329996 * v1z + 0.9470266676487 * v2z;
	f(&v,&r,args);
	r *= 0.00107509622745;
	q += r;
	v.x = v0x + 0.0774021329986 * v1x + 0.0081735455132 * v2x;
	v.y = v0y + 0.0774021329986 * v1y + 0.0081735455132 * v2y;
	v.z = v0z + 0.0774021329986 * v1z + 0.0081735455132 * v2z;
	f(&v,&r,args);
	r *= 0.001423365730125;
	q += r;
	v.x = v0x + 0.077402034151 * v1x + 0.9144244234031 * v2x;
	v.y = v0y + 0.077402034151 * v1y + 0.9144244234031 * v2y;
	v.z = v0z + 0.077402034151 * v1z + 0.9144244234031 * v2z;
	f(&v,&r,args);
	r *= 0.00142336600335;
	q += r;
	v.x = v0x + 0.3669315272539 * v1x + 0.383323243472 * v2x;
	v.y = v0y + 0.3669315272539 * v1y + 0.383323243472 * v2y;
	v.z = v0z + 0.3669315272539 * v1z + 0.383323243472 * v2z;
	f(&v,&r,args);
	r *= 0.001541096700375;
	q += r;
	v.x = v0x + 0.366931608594 * v1x + 0.2497451268005 * v2x;
	v.y = v0y + 0.366931608594 * v1y + 0.2497451268005 * v2y;
	v.z = v0z + 0.366931608594 * v1z + 0.2497451268005 * v2z;
	f(&v,&r,args);
	r *= 0.00154111891045;
	q += r;
	v.x = v0x + 0.00878208369970002 * v1x + 0.1035328809446 * v2x;
	v.y = v0y + 0.00878208369970002 * v1y + 0.1035328809446 * v2y;
	v.z = v0z + 0.00878208369970002 * v1z + 0.1035328809446 * v2z;
	f(&v,&r,args);
	r *= 0.001550362839775;
	q += r;
	v.x = v0x + 0.00878208398630009 * v1x + 0.887684993184 * v2x;
	v.y = v0y + 0.00878208398630009 * v1y + 0.887684993184 * v2y;
	v.z = v0z + 0.00878208398630009 * v1z + 0.887684993184 * v2z;
	f(&v,&r,args);
	r *= 0.0015503632988;
	q += r;
	v.x = v0x + 0.8519553084408 * v1x + 0.1403190991974 * v2x;
	v.y = v0y + 0.8519553084408 * v1y + 0.1403190991974 * v2y;
	v.z = v0z + 0.8519553084408 * v1z + 0.1403190991974 * v2z;
	f(&v,&r,args);
	r *= 0.00174090825735;
	q += r;
	v.x = v0x + 0.8519551640269 * v1x + 0.00772559346239998 * v2x;
	v.y = v0y + 0.8519551640269 * v1y + 0.00772559346239998 * v2y;
	v.z = v0z + 0.8519551640269 * v1z + 0.00772559346239998 * v2z;
	f(&v,&r,args);
	r *= 0.00174090829605;
	q += r;
	v.x = v0x + 0.00857664664219998 * v1x + 0.1809642523926 * v2x;
	v.y = v0y + 0.00857664664219998 * v1y + 0.1809642523926 * v2y;
	v.z = v0z + 0.00857664664219998 * v1z + 0.1809642523926 * v2z;
	f(&v,&r,args);
	r *= 0.001876656443;
	q += r;
	v.x = v0x + 0.0085766480949 * v1x + 0.8104590515334 * v2x;
	v.y = v0y + 0.0085766480949 * v1y + 0.8104590515334 * v2y;
	v.z = v0z + 0.0085766480949 * v1z + 0.8104590515334 * v2z;
	f(&v,&r,args);
	r *= 0.001876656614125;
	q += r;
	v.x = v0x + 0.1586221111639 * v1x + 0.0083010939677 * v2x;
	v.y = v0y + 0.1586221111639 * v1y + 0.0083010939677 * v2y;
	v.z = v0z + 0.1586221111639 * v1z + 0.0083010939677 * v2z;
	f(&v,&r,args);
	r *= 0.001976869208475;
	q += r;
	v.x = v0x + 0.1586220547482 * v1x + 0.8330768545392 * v2x;
	v.y = v0y + 0.1586220547482 * v1y + 0.8330768545392 * v2y;
	v.z = v0z + 0.1586220547482 * v1z + 0.8330768545392 * v2z;
	f(&v,&r,args);
	r *= 0.001976869312125;
	q += r;
	v.x = v0x + 0.9303185324371 * v1x + 0.0348406969482 * v2x;
	v.y = v0y + 0.9303185324371 * v1y + 0.0348406969482 * v2y;
	v.z = v0z + 0.9303185324371 * v1z + 0.0348406969482 * v2z;
	f(&v,&r,args);
	r *= 0.002008833615575;
	q += r;
	v.x = v0x + 0.0085730472444 * v1x + 0.7173981847948 * v2x;
	v.y = v0y + 0.0085730472444 * v1y + 0.7173981847948 * v2y;
	v.z = v0z + 0.0085730472444 * v1z + 0.7173981847948 * v2z;
	f(&v,&r,args);
	r *= 0.00219908602685;
	q += r;
	v.x = v0x + 0.00857304708359996 * v1x + 0.2740287304386 * v2x;
	v.y = v0y + 0.00857304708359996 * v1y + 0.2740287304386 * v2y;
	v.z = v0z + 0.00857304708359996 * v1z + 0.2740287304386 * v2z;
	f(&v,&r,args);
	r *= 0.0021990862028;
	q += r;
	v.x = v0x + 0.7523163959504 * v1x + 0.0081859182262 * v2x;
	v.y = v0y + 0.7523163959504 * v1y + 0.0081859182262 * v2y;
	v.z = v0z + 0.7523163959504 * v1z + 0.0081859182262 * v2z;
	f(&v,&r,args);
	r *= 0.0022826048929;
	q += r;
	v.x = v0x + 0.7523165247478 * v1x + 0.2394975566677 * v2x;
	v.y = v0y + 0.7523165247478 * v1y + 0.2394975566677 * v2y;
	v.z = v0z + 0.7523165247478 * v1z + 0.2394975566677 * v2z;
	f(&v,&r,args);
	r *= 0.002282605340275;
	q += r;
	v.x = v0x + 0.5087422955238 * v1x + 0.4843740892687 * v2x;
	v.y = v0y + 0.5087422955238 * v1y + 0.4843740892687 * v2y;
	v.z = v0z + 0.5087422955238 * v1z + 0.4843740892687 * v2z;
	f(&v,&r,args);
	r *= 0.002320543718775;
	q += r;
	v.x = v0x + 0.5087422281352 * v1x + 0.0068836232949 * v2x;
	v.y = v0y + 0.5087422281352 * v1y + 0.0068836232949 * v2y;
	v.z = v0z + 0.5087422281352 * v1z + 0.0068836232949 * v2z;
	f(&v,&r,args);
	r *= 0.00232054539155;
	q += r;
	v.x = v0x + 0.00784646977520009 * v1x + 0.4960767529507 * v2x;
	v.y = v0y + 0.00784646977520009 * v1y + 0.4960767529507 * v2y;
	v.z = v0z + 0.00784646977520009 * v1z + 0.4960767529507 * v2z;
	f(&v,&r,args);
	r *= 0.00236249515445;
	q += r;
	v.x = v0x + 0.00827395325159996 * v1x + 0.3804323691239 * v2x;
	v.y = v0y + 0.00827395325159996 * v1y + 0.3804323691239 * v2y;
	v.z = v0z + 0.00827395325159996 * v1z + 0.3804323691239 * v2z;
	f(&v,&r,args);
	r *= 0.0023656867121;
	q += r;
	v.x = v0x + 0.00827395531219999 * v1x + 0.6112936466533 * v2x;
	v.y = v0y + 0.00827395531219999 * v1y + 0.6112936466533 * v2y;
	v.z = v0z + 0.00827395531219999 * v1z + 0.6112936466533 * v2z;
	f(&v,&r,args);
	r *= 0.00236568713235;
	q += r;
	v.x = v0x + 0.2612122106775 * v1x + 0.0083987179701 * v2x;
	v.y = v0y + 0.2612122106775 * v1y + 0.0083987179701 * v2y;
	v.z = v0z + 0.2612122106775 * v1z + 0.0083987179701 * v2z;
	f(&v,&r,args);
	r *= 0.002388894307125;
	q += r;
	v.x = v0x + 0.2612121935954 * v1x + 0.7303890895407 * v2x;
	v.y = v0y + 0.2612121935954 * v1y + 0.7303890895407 * v2y;
	v.z = v0z + 0.2612121935954 * v1z + 0.7303890895407 * v2z;
	f(&v,&r,args);
	r *= 0.002388894821075;
	q += r;
	v.x = v0x + 0.3795998344693 * v1x + 0.0075475979695 * v2x;
	v.y = v0y + 0.3795998344693 * v1y + 0.0075475979695 * v2y;
	v.z = v0z + 0.3795998344693 * v1z + 0.0075475979695 * v2z;
	f(&v,&r,args);
	r *= 0.0024034710622;
	q += r;
	v.x = v0x + 0.3795998554381 * v1x + 0.6128525484582 * v2x;
	v.y = v0y + 0.3795998554381 * v1y + 0.6128525484582 * v2y;
	v.z = v0z + 0.3795998554381 * v1z + 0.6128525484582 * v2z;
	f(&v,&r,args);
	r *= 0.00240347117065;
	q += r;
	v.x = v0x + 0.6360700856766 * v1x + 0.3559773826721 * v2x;
	v.y = v0y + 0.6360700856766 * v1y + 0.3559773826721 * v2y;
	v.z = v0z + 0.6360700856766 * v1z + 0.3559773826721 * v2z;
	f(&v,&r,args);
	r *= 0.0024997881053;
	q += r;
	v.x = v0x + 0.6360699771038 * v1x + 0.00795253585019999 * v2x;
	v.y = v0y + 0.6360699771038 * v1y + 0.00795253585019999 * v2y;
	v.z = v0z + 0.6360699771038 * v1z + 0.00795253585019999 * v2z;
	f(&v,&r,args);
	r *= 0.00249978879625;
	q += r;
	v.x = v0x + 0.0452529356689 * v1x + 0.0437233665345 * v2x;
	v.y = v0y + 0.0452529356689 * v1y + 0.0437233665345 * v2y;
	v.z = v0z + 0.0452529356689 * v1z + 0.0437233665345 * v2z;
	f(&v,&r,args);
	r *= 0.002507532981925;
	q += r;
	v.x = v0x + 0.0452529587388 * v1x + 0.9110236807446 * v2x;
	v.y = v0y + 0.0452529587388 * v1y + 0.9110236807446 * v2y;
	v.z = v0z + 0.0452529587388 * v1z + 0.9110236807446 * v2z;
	f(&v,&r,args);
	r *= 0.0025075336659;
	q += r;
	v.x = v0x + 0.8644489029883 * v1x + 0.0967030908282 * v2x;
	v.y = v0y + 0.8644489029883 * v1y + 0.0967030908282 * v2y;
	v.z = v0z + 0.8644489029883 * v1z + 0.0967030908282 * v2z;
	f(&v,&r,args);
	r *= 0.003123416904625;
	q += r;
	v.x = v0x + 0.8644487939678 * v1x + 0.0388479942386 * v2x;
	v.y = v0y + 0.8644487939678 * v1y + 0.0388479942386 * v2y;
	v.z = v0z + 0.8644487939678 * v1z + 0.0388479942386 * v2z;
	f(&v,&r,args);
	r *= 0.003123418153125;
	q += r;
	v.x = v0x + 0.8253546468297 * v1x + 0.0873226620391 * v2x;
	v.y = v0y + 0.8253546468297 * v1y + 0.0873226620391 * v2y;
	v.z = v0z + 0.8253546468297 * v1z + 0.0873226620391 * v2z;
	f(&v,&r,args);
	r *= 0.003504932728425;
	q += r;
	v.x = v0x + 0.1092937008808 * v1x + 0.8485617789108 * v2x;
	v.y = v0y + 0.1092937008808 * v1y + 0.8485617789108 * v2y;
	v.z = v0z + 0.1092937008808 * v1z + 0.8485617789108 * v2z;
	f(&v,&r,args);
	r *= 0.0035834054224;
	q += r;
	v.x = v0x + 0.1092936604124 * v1x + 0.0421445420915 * v2x;
	v.y = v0y + 0.1092936604124 * v1y + 0.0421445420915 * v2y;
	v.z = v0z + 0.1092936604124 * v1z + 0.0421445420915 * v2z;
	f(&v,&r,args);
	r *= 0.003583406803125;
	q += r;
	v.x = v0x + 0.0454642723664 * v1x + 0.1067435942472 * v2x;
	v.y = v0y + 0.0454642723664 * v1y + 0.1067435942472 * v2y;
	v.z = v0z + 0.0454642723664 * v1z + 0.1067435942472 * v2z;
	f(&v,&r,args);
	r *= 0.0038401035685;
	q += r;
	v.x = v0x + 0.0454642782456001 * v1x + 0.8477921328146 * v2x;
	v.y = v0y + 0.0454642782456001 * v1y + 0.8477921328146 * v2y;
	v.z = v0z + 0.0454642782456001 * v1z + 0.8477921328146 * v2z;
	f(&v,&r,args);
	r *= 0.003840104585625;
	q += r;
	v.x = v0x + 0.7749692956401 * v1x + 0.0416340521608 * v2x;
	v.y = v0y + 0.7749692956401 * v1y + 0.0416340521608 * v2y;
	v.z = v0z + 0.7749692956401 * v1z + 0.0416340521608 * v2z;
	f(&v,&r,args);
	r *= 0.00461309564035;
	q += r;
	v.x = v0x + 0.7749694261903 * v1x + 0.183396519693 * v2x;
	v.y = v0y + 0.7749694261903 * v1y + 0.183396519693 * v2y;
	v.z = v0z + 0.7749694261903 * v1z + 0.183396519693 * v2z;
	f(&v,&r,args);
	r *= 0.00461309657865;
	q += r;
	v.x = v0x + 0.0446768545588 * v1x + 0.1941599202852 * v2x;
	v.y = v0y + 0.0446768545588 * v1y + 0.1941599202852 * v2y;
	v.z = v0z + 0.0446768545588 * v1z + 0.1941599202852 * v2z;
	f(&v,&r,args);
	r *= 0.004895849589325;
	q += r;
	v.x = v0x + 0.0446768591918 * v1x + 0.7611632153938 * v2x;
	v.y = v0y + 0.0446768591918 * v1y + 0.7611632153938 * v2y;
	v.z = v0z + 0.0446768591918 * v1z + 0.7611632153938 * v2z;
	f(&v,&r,args);
	r *= 0.00489585049985;
	q += r;
	v.x = v0x + 0.1980794644241 * v1x + 0.0439826608586 * v2x;
	v.y = v0y + 0.1980794644241 * v1y + 0.0439826608586 * v2y;
	v.z = v0z + 0.1980794644241 * v1z + 0.0439826608586 * v2z;
	f(&v,&r,args);
	r *= 0.00494081878355;
	q += r;
	v.x = v0x + 0.1980795245297 * v1x + 0.7579378242308 * v2x;
	v.y = v0y + 0.1980795245297 * v1y + 0.7579378242308 * v2y;
	v.z = v0z + 0.1980795245297 * v1z + 0.7579378242308 * v2z;
	f(&v,&r,args);
	r *= 0.004940819166925;
	q += r;
	v.x = v0x + 0.4267053387646 * v1x + 0.5363186076436 * v2x;
	v.y = v0y + 0.4267053387646 * v1y + 0.5363186076436 * v2y;
	v.z = v0z + 0.4267053387646 * v1z + 0.5363186076436 * v2z;
	f(&v,&r,args);
	r *= 0.004970159775475;
	q += r;
	v.x = v0x + 0.4267052084723 * v1x + 0.0369760780935 * v2x;
	v.y = v0y + 0.4267052084723 * v1y + 0.0369760780935 * v2y;
	v.z = v0z + 0.4267052084723 * v1z + 0.0369760780935 * v2z;
	f(&v,&r,args);
	r *= 0.0049701621444;
	q += r;
	v.x = v0x + 0.1086475957534 * v1x + 0.7912267093545 * v2x;
	v.y = v0y + 0.1086475957534 * v1y + 0.7912267093545 * v2y;
	v.z = v0z + 0.1086475957534 * v1z + 0.7912267093545 * v2z;
	f(&v,&r,args);
	r *= 0.0051795459621;
	q += r;
	v.x = v0x + 0.1086475751803 * v1x + 0.1001257554673 * v2x;
	v.y = v0y + 0.1086475751803 * v1y + 0.1001257554673 * v2y;
	v.z = v0z + 0.1086475751803 * v1z + 0.1001257554673 * v2z;
	f(&v,&r,args);
	r *= 0.005179548372325;
	q += r;
	v.x = v0x + 0.5462720157265 * v1x + 0.4157413128558 * v2x;
	v.y = v0y + 0.5462720157265 * v1y + 0.4157413128558 * v2y;
	v.z = v0z + 0.5462720157265 * v1z + 0.4157413128558 * v2z;
	f(&v,&r,args);
	r *= 0.005223576786;
	q += r;
	v.x = v0x + 0.54627189095 * v1x + 0.0379867061535 * v2x;
	v.y = v0y + 0.54627189095 * v1y + 0.0379867061535 * v2y;
	v.z = v0z + 0.54627189095 * v1z + 0.0379867061535 * v2z;
	f(&v,&r,args);
	r *= 0.0052235812989;
	q += r;
	v.x = v0x + 0.3072752281824 * v1x + 0.0420141226713 * v2x;
	v.y = v0y + 0.3072752281824 * v1y + 0.0420141226713 * v2y;
	v.z = v0z + 0.3072752281824 * v1z + 0.0420141226713 * v2z;
	f(&v,&r,args);
	r *= 0.005371614347125;
	q += r;
	v.x = v0x + 0.3072753221478 * v1x + 0.6507105645084 * v2x;
	v.y = v0y + 0.3072753221478 * v1y + 0.6507105645084 * v2y;
	v.z = v0z + 0.3072753221478 * v1z + 0.6507105645084 * v2z;
	f(&v,&r,args);
	r *= 0.005371614650175;
	q += r;
	v.x = v0x + 0.6653825532262 * v1x + 0.2920626023484 * v2x;
	v.y = v0y + 0.6653825532262 * v1y + 0.2920626023484 * v2y;
	v.z = v0z + 0.6653825532262 * v1z + 0.2920626023484 * v2z;
	f(&v,&r,args);
	r *= 0.0055554533259;
	q += r;
	v.x = v0x + 0.6653824346007 * v1x + 0.0425548546753 * v2x;
	v.y = v0y + 0.6653824346007 * v1y + 0.0425548546753 * v2y;
	v.z = v0z + 0.6653824346007 * v1z + 0.0425548546753 * v2z;
	f(&v,&r,args);
	r *= 0.005555454005075;
	q += r;
	v.x = v0x + 0.0417238992814999 * v1x + 0.4193031469005 * v2x;
	v.y = v0y + 0.0417238992814999 * v1y + 0.4193031469005 * v2y;
	v.z = v0z + 0.0417238992814999 * v1z + 0.4193031469005 * v2z;
	f(&v,&r,args);
	r *= 0.005583632636375;
	q += r;
	v.x = v0x + 0.0417239077901 * v1x + 0.538972909361 * v2x;
	v.y = v0y + 0.0417239077901 * v1y + 0.538972909361 * v2y;
	v.z = v0z + 0.0417239077901 * v1z + 0.538972909361 * v2z;
	f(&v,&r,args);
	r *= 0.005583634468475;
	q += r;
	v.x = v0x + 0.0443175354138 * v1x + 0.3007352636162 * v2x;
	v.y = v0y + 0.0443175354138 * v1y + 0.3007352636162 * v2y;
	v.z = v0z + 0.0443175354138 * v1z + 0.3007352636162 * v2z;
	f(&v,&r,args);
	r *= 0.00561897312365;
	q += r;
	v.x = v0x + 0.0443175396352 * v1x + 0.6549471812731 * v2x;
	v.y = v0y + 0.0443175396352 * v1y + 0.6549471812731 * v2y;
	v.z = v0z + 0.0443175396352 * v1z + 0.6549471812731 * v2z;
	f(&v,&r,args);
	r *= 0.005618974511;
	q += r;
	v.x = v0x + 0.2793619097663 * v1x + 0.3453980130752 * v2x;
	v.y = v0y + 0.2793619097663 * v1y + 0.3453980130752 * v2y;
	v.z = v0z + 0.2793619097663 * v1z + 0.3453980130752 * v2z;
	f(&v,&r,args);
	r *= 0.005742534896125;
	q += r;
	v.x = v0x + 0.2793619021541 * v1x + 0.3752400695673 * v2x;
	v.y = v0y + 0.2793619021541 * v1y + 0.3752400695673 * v2y;
	v.z = v0z + 0.2793619021541 * v1z + 0.3752400695673 * v2z;
	f(&v,&r,args);
	r *= 0.00574258486095;
	q += r;
	v.x = v0x + 0.7407159136052 * v1x + 0.1598308695187 * v2x;
	v.y = v0y + 0.7407159136052 * v1y + 0.1598308695187 * v2y;
	v.z = v0z + 0.7407159136052 * v1z + 0.1598308695187 * v2z;
	f(&v,&r,args);
	r *= 0.00581995940255;
	q += r;
	v.x = v0x + 0.7407158680283 * v1x + 0.0994531960132 * v2x;
	v.y = v0y + 0.7407158680283 * v1y + 0.0994531960132 * v2y;
	v.z = v0z + 0.7407158680283 * v1z + 0.0994531960132 * v2z;
	f(&v,&r,args);
	r *= 0.00581996068765;
	q += r;
	v.x = v0x + 0.1078087907409 * v1x + 0.7124585430924 * v2x;
	v.y = v0y + 0.1078087907409 * v1y + 0.7124585430924 * v2y;
	v.z = v0z + 0.1078087907409 * v1z + 0.7124585430924 * v2z;
	f(&v,&r,args);
	r *= 0.006737079991175;
	q += r;
	v.x = v0x + 0.1078087815817 * v1x + 0.179732772224 * v2x;
	v.y = v0y + 0.1078087815817 * v1y + 0.179732772224 * v2y;
	v.z = v0z + 0.1078087815817 * v1z + 0.179732772224 * v2z;
	f(&v,&r,args);
	r *= 0.006737082677675;
	q += r;
	v.x = v0x + 0.1932232537189 * v1x + 0.7001701784175 * v2x;
	v.y = v0y + 0.1932232537189 * v1y + 0.7001701784175 * v2y;
	v.z = v0z + 0.1932232537189 * v1z + 0.7001701784175 * v2z;
	f(&v,&r,args);
	r *= 0.00701096895025;
	q += r;
	v.x = v0x + 0.1932232240227 * v1x + 0.1066065855677 * v2x;
	v.y = v0y + 0.1932232240227 * v1y + 0.1066065855677 * v2y;
	v.z = v0z + 0.1932232240227 * v1z + 0.1066065855677 * v2z;
	f(&v,&r,args);
	r *= 0.007010969115175;
	q += r;
	v.x = v0x + 0.2941048385403 * v1x + 0.6065647984796 * v2x;
	v.y = v0y + 0.2941048385403 * v1y + 0.6065647984796 * v2y;
	v.z = v0z + 0.2941048385403 * v1z + 0.6065647984796 * v2z;
	f(&v,&r,args);
	r *= 0.0071881567543;
	q += r;
	v.x = v0x + 0.294104805071 * v1x + 0.0993303896769 * v2x;
	v.y = v0y + 0.294104805071 * v1y + 0.0993303896769 * v2y;
	v.z = v0z + 0.294104805071 * v1z + 0.0993303896769 * v2z;
	f(&v,&r,args);
	r *= 0.007188159681775;
	q += r;
	v.x = v0x + 0.6443394877768 * v1x + 0.2533381579528 * v2x;
	v.y = v0y + 0.6443394877768 * v1y + 0.2533381579528 * v2y;
	v.z = v0z + 0.6443394877768 * v1z + 0.2533381579528 * v2z;
	f(&v,&r,args);
	r *= 0.007474520726575;
	q += r;
	v.x = v0x + 0.6443393848873 * v1x + 0.1023223826189 * v2x;
	v.y = v0y + 0.6443393848873 * v1y + 0.1023223826189 * v2y;
	v.z = v0z + 0.6443393848873 * v1z + 0.1023223826189 * v2z;
	f(&v,&r,args);
	r *= 0.007474523068975;
	q += r;
	v.x = v0x + 0.1064271224208 * v1x + 0.2769502060575 * v2x;
	v.y = v0y + 0.1064271224208 * v1y + 0.2769502060575 * v2y;
	v.z = v0z + 0.1064271224208 * v1z + 0.2769502060575 * v2z;
	f(&v,&r,args);
	r *= 0.0077251089629;
	q += r;
	v.x = v0x + 0.1064271406267 * v1x + 0.6166227900624 * v2x;
	v.y = v0y + 0.1064271406267 * v1y + 0.6166227900624 * v2y;
	v.z = v0z + 0.1064271406267 * v1z + 0.6166227900624 * v2z;
	f(&v,&r,args);
	r *= 0.0077251096489;
	q += r;
	v.x = v0x + 0.4114292791126 * v1x + 0.4981522637001 * v2x;
	v.y = v0y + 0.4114292791126 * v1y + 0.4981522637001 * v2y;
	v.z = v0z + 0.4114292791126 * v1z + 0.4981522637001 * v2z;
	f(&v,&r,args);
	r *= 0.0078507754272;
	q += r;
	v.x = v0x + 0.4114292187603 * v1x + 0.0904185045149 * v2x;
	v.y = v0y + 0.4114292187603 * v1y + 0.0904185045149 * v2y;
	v.z = v0z + 0.4114292187603 * v1z + 0.0904185045149 * v2z;
	f(&v,&r,args);
	r *= 0.007850776848875;
	q += r;
	v.x = v0x + 0.5333349622924 * v1x + 0.3738418516908 * v2x;
	v.y = v0y + 0.5333349622924 * v1y + 0.3738418516908 * v2y;
	v.z = v0z + 0.5333349622924 * v1z + 0.3738418516908 * v2z;
	f(&v,&r,args);
	r *= 0.0079797888256;
	q += r;
	v.x = v0x + 0.5333348715981 * v1x + 0.092823258479 * v2x;
	v.y = v0y + 0.5333348715981 * v1y + 0.092823258479 * v2y;
	v.z = v0z + 0.5333348715981 * v1z + 0.092823258479 * v2z;
	f(&v,&r,args);
	r *= 0.00797979170945;
	q += r;
	v.x = v0x + 0.4956640233896 * v1x + 0.2521680925697 * v2x;
	v.y = v0y + 0.4956640233896 * v1y + 0.2521680925697 * v2y;
	v.z = v0z + 0.4956640233896 * v1z + 0.2521680925697 * v2z;
	f(&v,&r,args);
	r *= 0.00803574810155;
	q += r;
	v.x = v0x + 0.1006919236962 * v1x + 0.390558054433 * v2x;
	v.y = v0y + 0.1006919236962 * v1y + 0.390558054433 * v2y;
	v.z = v0z + 0.1006919236962 * v1z + 0.390558054433 * v2z;
	f(&v,&r,args);
	r *= 0.0082598900347;
	q += r;
	v.x = v0x + 0.1006919445608 * v1x + 0.5087501437661 * v2x;
	v.y = v0y + 0.1006919445608 * v1y + 0.5087501437661 * v2y;
	v.z = v0z + 0.1006919445608 * v1z + 0.5087501437661 * v2z;
	f(&v,&r,args);
	r *= 0.008259890795725;
	q += r;
	v.x = v0x + 0.302712049135 * v1x + 0.5266738039554 * v2x;
	v.y = v0y + 0.302712049135 * v1y + 0.5266738039554 * v2y;
	v.z = v0z + 0.302712049135 * v1z + 0.5266738039554 * v2z;
	f(&v,&r,args);
	r *= 0.008904227389725;
	q += r;
	v.x = v0x + 0.3027119981151 * v1x + 0.1706142257537 * v2x;
	v.y = v0y + 0.3027119981151 * v1y + 0.1706142257537 * v2y;
	v.z = v0z + 0.3027119981151 * v1z + 0.1706142257537 * v2z;
	f(&v,&r,args);
	r *= 0.00890423190135;
	q += r;
	v.x = v0x + 0.3924363387485 * v1x + 0.2588055084886 * v2x;
	v.y = v0y + 0.3924363387485 * v1y + 0.2588055084886 * v2y;
	v.z = v0z + 0.3924363387485 * v1z + 0.2588055084886 * v2z;
	f(&v,&r,args);
	r *= 0.00914352974995;
	q += r;
	v.x = v0x + 0.392436291228 * v1x + 0.3487583491703 * v2x;
	v.y = v0y + 0.392436291228 * v1y + 0.3487583491703 * v2y;
	v.z = v0z + 0.392436291228 * v1z + 0.3487583491703 * v2z;
	f(&v,&r,args);
	r *= 0.0091435378801;
	q += r;
	v.x = v0x + 0.5289863257983 * v1x + 0.3013522183964 * v2x;
	v.y = v0y + 0.5289863257983 * v1y + 0.3013522183964 * v2y;
	v.z = v0z + 0.5289863257983 * v1z + 0.3013522183964 * v2z;
	f(&v,&r,args);
	r *= 0.00914944117475;
	q += r;
	v.x = v0x + 0.5289862229906 * v1x + 0.1696615963219 * v2x;
	v.y = v0y + 0.5289862229906 * v1y + 0.1696615963219 * v2y;
	v.z = v0z + 0.5289862229906 * v1z + 0.1696615963219 * v2z;
	f(&v,&r,args);
	r *= 0.009149451347225;
	q += r;
	v.x = v0x + 0.2835055815763 * v1x + 0.4584741774478 * v2x;
	v.y = v0y + 0.2835055815763 * v1y + 0.4584741774478 * v2y;
	v.z = v0z + 0.2835055815763 * v1z + 0.4584741774478 * v2z;
	f(&v,&r,args);
	r *= 0.00924864200285;
	q += r;
	v.x = v0x + 0.2835055320791 * v1x + 0.2580203819011 * v2x;
	v.y = v0y + 0.2835055320791 * v1y + 0.2580203819011 * v2y;
	v.z = v0z + 0.2835055320791 * v1z + 0.2580203819011 * v2z;
	f(&v,&r,args);
	r *= 0.009248644376475;
	q += r;
	v.x = v0x + 0.6302202611951 * v1x + 0.1848898704551 * v2x;
	v.y = v0y + 0.6302202611951 * v1y + 0.1848898704551 * v2y;
	v.z = v0z + 0.6302202611951 * v1z + 0.1848898704551 * v2z;
	f(&v,&r,args);
	r *= 0.009351340594675;
	q += r;
	v.x = v0x + 0.1947647667466 * v1x + 0.1921611994069 * v2x;
	v.y = v0y + 0.1947647667466 * v1y + 0.1921611994069 * v2y;
	v.z = v0z + 0.1947647667466 * v1z + 0.1921611994069 * v2z;
	f(&v,&r,args);
	r *= 0.009388756457925;
	q += r;
	v.x = v0x + 0.1947647850617 * v1x + 0.6130740398389 * v2x;
	v.y = v0y + 0.1947647850617 * v1y + 0.6130740398389 * v2y;
	v.z = v0z + 0.1947647850617 * v1z + 0.6130740398389 * v2z;
	f(&v,&r,args);
	r *= 0.00938875781325;
	q += r;
	v.x = v0x + 0.4168845502985 * v1x + 0.1650613336416 * v2x;
	v.y = v0y + 0.4168845502985 * v1y + 0.1650613336416 * v2y;
	v.z = v0z + 0.4168845502985 * v1z + 0.1650613336416 * v2z;
	f(&v,&r,args);
	r *= 0.00972219233715;
	q += r;
	v.x = v0x + 0.416884615872 * v1x + 0.4180541199244 * v2x;
	v.y = v0y + 0.416884615872 * v1y + 0.4180541199244 * v2y;
	v.z = v0z + 0.416884615872 * v1z + 0.4180541199244 * v2z;
	f(&v,&r,args);
	r *= 0.00972219270855;
	q += r;
	v.x = v0x + 0.1858075255146 * v1x + 0.2982719005229 * v2x;
	v.y = v0y + 0.1858075255146 * v1y + 0.2982719005229 * v2y;
	v.z = v0z + 0.1858075255146 * v1z + 0.2982719005229 * v2z;
	f(&v,&r,args);
	r *= 0.0098176410887;
	q += r;
	v.x = v0x + 0.1858075529888 * v1x + 0.5159205534362 * v2x;
	v.y = v0y + 0.1858075529888 * v1y + 0.5159205534362 * v2y;
	v.z = v0z + 0.1858075529888 * v1z + 0.5159205534362 * v2z;
	f(&v,&r,args);
	r *= 0.009817645062925;
	q += r;
	v.x = v0x + 0.1802211079868 * v1x + 0.4098894317792 * v2x;
	v.y = v0y + 0.1802211079868 * v1y + 0.4098894317792 * v2y;
	v.z = v0z + 0.1802211079868 * v1z + 0.4098894317792 * v2z;
	f(&v,&r,args);
	r *= 0.009969171995775;
	q += r;
	return q;
}


template<class T, class F>
T quadgauss105_4(F f, FunctionArgs *args, Vector3 &v1, Vector3 &v2, Vector3 *v0in, void *quadargs, Real reltol, Real abstol)
{
  T q;
  Vector3 v1sub = 0.5 * v1;
  Vector3 v2sub = 0.5 * v2;

  Vector3 v0(0.,0.,0.);
  q = quadgauss105<T,F>(f,args,v1sub,v2sub,&v0,NULL,reltol,abstol);
  v0 = v1sub;
  q += quadgauss105<T,F>(f,args,v1sub,v2sub,&v0,NULL,reltol,abstol);
  v0 = v2sub;
  q += quadgauss105<T,F>(f,args,v1sub,v2sub,&v0,NULL,reltol,abstol);
  v0 += v1sub;

  v1sub.x = -v1sub.x;
  v1sub.y = -v1sub.y;
  v1sub.z = -v1sub.z;
  v2sub.x = -v2sub.x;
  v2sub.y = -v2sub.y;
  v2sub.z = -v2sub.z;
  q += quadgauss105<T,F>(f,args,v1sub,v2sub,&v0,NULL,reltol,abstol);

  return 0.25 * q;
}

template<class T, class F>
  struct AdaptiveQuadArgs
  {
    T **fc;
    int depth;
  };

template<class T, class F>
  struct AdaptiveQuadLogArgs
  {
    T **fc;
    int depth;
    F limitfunc;
    Vector3 vx;
    Vector3 vy;
    Real theta1;
    Real beta;
    Real alpha;
  };

#define TQ5_D1 0.25
#define TQ5_D2 0.5
#define TQ5_D3 0.75
#define TQ5_SUB 0.25
#define TQ55_K0 0.0
#define TQ55_K1 0.04444444444444444444
#define TQ55_K2 -0.01111111111111111111
#define TQ55_K3 0.08888888888888888888
#define TQ53_K0 0.0
#define TQ53_K1 0.04166666666666666667
#define TQ53_K2 0.0
#define TQ53_K3 0.08333333333333333333

template<class T, class F>
T quad5553(F f,
           FunctionArgs *args,
           Vector3 &v1, 
           Vector3 &v2, 
           Vector3 *v0in,
           void *quadargs,
           Real reltol,
           Real abstol)
{
  
  AdaptiveQuadArgs<T,F> *qargs = (AdaptiveQuadArgs<T,F>*)quadargs;
  T **fc = qargs?qargs->fc:NULL;

  Vector3 v1sub;
  Vector3 v2sub;

  v1sub.x = TQ5_D1 * v1.x;
  v1sub.y = TQ5_D1 * v1.y;
  v1sub.z = TQ5_D1 * v1.z;
  
  v2sub.x = TQ5_D1 * v2.x;
  v2sub.y = TQ5_D1 * v2.y;
  v2sub.z = TQ5_D1 * v2.z;

  Vector3 v02;
  Vector3 v09;
  Vector3 v011;

  Vector3 v0;
  Vector3 v(0.0,0.0,0.0);
  if(v0in == NULL) {
    v0 = v;
  } else {
    v0 = *v0in;
  }

  T tq5_1;
  T tq5_2;
  T tq5_3;

  v.x = v0.x + v1sub.x;
  v.y = v0.y + v1sub.y;
  v.z = v0.z + v1sub.z;
  T f1;
  f(&v,&f1,args);
  tq5_1 = f1;

  v02.x = v.x + v1sub.x;
  v02.y = v.y + v1sub.y;
  v02.z = v.z + v1sub.z;
  T f2;
  if(fc == NULL)
    f(&v02,&f2,args);
  else
    f2 = *(fc[0]);
  tq5_2 = f2;

  v.x = v02.x + v1sub.x;
  v.y = v02.y + v1sub.y;
  v.z = v02.z + v1sub.z;
  T f3;
  f(&v,&f3,args);
  tq5_1 += f3;

  v.x += v2sub.x;
  v.y += v2sub.y;
  v.z += v2sub.z;
  T f8;
  f(&v,&f8,args);
  tq5_1 += f8;

  v.x -= v1sub.x;
  v.y -= v1sub.y;
  v.z -= v1sub.z;
  T f7;
  f(&v,&f7,args);
  tq5_3 = f7;

  v011.x = v.x + v2sub.x;
  v011.y = v.y + v2sub.y;
  v011.z = v.z + v2sub.z;
  T f11;
  if(fc == NULL)
    f(&v011,&f11,args);
  else
    f11 = *(fc[2]);
  tq5_2 += f11;

  v.x = v011.x - v1sub.x;
  v.y = v011.y - v1sub.y;
  v.z = v011.z - v1sub.z;
  T f10;
  f(&v,&f10,args);
  tq5_3 += f10;

  v.x -= v2sub.x;
  v.y -= v2sub.y;
  v.z -= v2sub.z;
  T f6;
  f(&v,&f6,args);
  tq5_3 += f6;

  v.x -= v1sub.x;
  v.y -= v1sub.y;
  v.z -= v1sub.z;
  T f5;
  f(&v,&f5,args);
  tq5_1 += f5;

  v09.x = v.x + v2sub.x;
  v09.y = v.y + v2sub.y;
  v09.z = v.z + v2sub.z;
  T f9;
  if(fc == NULL)
    f(&v09,&f9,args);
  else
    f9 = *(fc[1]);
  tq5_2 += f9;

  v.x = v09.x + v2sub.x;
  v.y = v09.y + v2sub.y;
  v.z = v09.z + v2sub.z;
  T f12;
  f(&v,&f12,args);
  tq5_1 += f12;

  v.x += v1sub.x;
  v.y += v1sub.y;
  v.z += v1sub.z;
  T f13;
  f(&v,&f13,args);
  tq5_1 += f13;

  T tq55 = TQ55_K1*tq5_1;
  tq55 += TQ55_K2*tq5_2;
  tq55 += TQ55_K3*tq5_3;
  T tq53 = TQ53_K1*tq5_1;
  tq53 += TQ53_K3*tq5_3;

  T diff = tq55;
  diff -= tq53;
  Real abserr = norm(diff);
  Real absval = norm(tq55);
  
  //cout << (qargs?qargs->depth:0) << " " << absval <<  " " << abserr <<  " " << absval * reltol << " " <<  abstol << "\n";

  abstol = max(abstol,absval*reltol);
  if((qargs && qargs->depth > QUADMAXDEPTH) || abserr <= abstol) {
    return tq55;
  } else {
    T q5553;

    AdaptiveQuadArgs<T,F> qargssub;
    if(qargs)
      qargssub.depth = qargs->depth + 1;
    else
      qargssub.depth = 0;

    v1sub.x = 0.5*v1.x;
    v1sub.y = 0.5*v1.y;
    v1sub.z = 0.5*v1.z;

    v2sub.x = 0.5*v2.x;
    v2sub.y = 0.5*v2.y;
    v2sub.z = 0.5*v2.z;

    T* fcs[3];
    qargssub.fc = fcs;

    T q1 = f1; q1 += f5; q1 += f6; q1 *= ONETWENTYFOURTH;
    Real absval1 = max(ONESIXTEENTH*absval,norm(q1));
    fcs[0] = &f1; fcs[1] = &f5; fcs[2] = &f6; 
    q5553 = quad5553<T,F>(f,args,v1sub,v2sub,&v0,&qargssub,reltol,abstol*absval/absval1);

    T q2 = f3; q2 += f7; q2 += f8; q2 *= ONETWENTYFOURTH;
    Real absval2 = max(ONESIXTEENTH*absval,norm(q2));
    fcs[0] = &f3; fcs[1] = &f7; fcs[2] = &f8; 
    q5553 += quad5553<T,F>(f,args,v1sub,v2sub,&v02,&qargssub,reltol,abstol*absval/absval2);

    T q3 = f10; q3 += f12; q3 += f13; q3 *= ONETWENTYFOURTH;
    Real absval3 = max(ONESIXTEENTH*absval,norm(q3));
    fcs[0] = &f10; fcs[1] = &f12; fcs[2] = &f13; 
    q5553 += quad5553<T,F>(f,args,v1sub,v2sub,&v09,&qargssub,reltol,abstol*absval/absval3);

    v1sub.x = -v1sub.x;
    v1sub.y = -v1sub.y;
    v1sub.z = -v1sub.z;
    v2sub.x = -v2sub.x;
    v2sub.y = -v2sub.y;
    v2sub.z = -v2sub.z;

    T q4 = f10; q4 += f7; q4 += f6; q4 *= ONETWENTYFOURTH;
    Real absval4 = max(ONESIXTEENTH*absval,norm(q4));
    fcs[0] = &f10; fcs[1] = &f7; fcs[2] = &f6; 
    q5553 += quad5553<T,F>(f,args,v1sub,v2sub,&v011,&qargssub,reltol,abstol*absval/absval4);

    //printf("%g %g %g %g %g\n",absval,absval1,absval2,absval3,absval4);
    return TQ5_SUB * q5553;
  }
}


#endif
